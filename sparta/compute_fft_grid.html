

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>compute fft/grid command &mdash; SPARTA 6 Jul 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygm_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                6 Jul 2020  (build: 22/07/2020)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>

            
          
  <a href= "genindex.html">Index</a>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>compute fft/grid command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/compute_fft_grid.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compute-fft-grid-command">
<span id="command-compute-fft-grid"></span><span id="index-0"></span><h1>compute fft/grid command<a class="headerlink" href="#compute-fft-grid-command" title="Permalink to this headline">¶</a></h1>
<div class="section" id="syntax">
<h2>Syntax:<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xorg.conf notranslate"><div class="highlight"><pre><span></span><span class="nb">compute</span> <span class="no">ID fft/grid value1 value2 ... keyword args ...</span>
</pre></div>
</div>
<ul>
<li><p>ID is documented in <a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute command</span></a></p></li>
<li><p>fft/grid = style name of this compute command</p></li>
<li><p>one or more values can be appended</p></li>
<li><p>value = c_ID, c_ID[N], f_ID, f_ID[N], v_name</p>
<ul class="simple">
<li><p>c_ID = per-grid vector calculated by a compute with ID</p></li>
<li><p>c_ID[I] = Ith column of per-grid array calculated by a compute with ID</p></li>
<li><p>f_ID = per-grid vector calculated by a fix with ID</p></li>
<li><p>f_ID[I] = Ith column of per-grid or array calculated by a fix with ID</p></li>
<li><p>v_name = per-grid vector calculated by a grid-style variable with name</p></li>
</ul>
</li>
<li><p>zero or more keyword/arg pairs can be appended</p>
<p>keyword = <code class="docutils literal notranslate"><span class="pre">sum</span></code> or <code class="docutils literal notranslate"><span class="pre">scale</span></code> or <code class="docutils literal notranslate"><span class="pre">conjugate</span></code> or <code class="docutils literal notranslate"><span class="pre">kmag</span></code></p>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>sum = yes or no to sum all FFTs into a single output</p></li>
<li><p>scale = sfactor = numeric value to scale results by</p></li>
<li><p>conjugate = yes or no = perform complex conjugate multiply or not</p></li>
<li><p>kx = yes or no = calculate x-component of wavelength or not</p></li>
<li><p>kx = yes or no = calculate y-component of wavelength or not</p></li>
<li><p>kx = yes or no = calculate z-component of wavelength or not</p></li>
<li><p>kmag = yes or no = calculate wavelength magnitude or not</p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="examples">
<h2>Examples:<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-xorg.conf notranslate"><div class="highlight"><pre><span></span><span class="nb">compute</span> <span class="no">1 fft/grid c_1</span>
</pre></div>
</div>
<p>These commands will dump FFTs of instantaneous and time-averaged
velocity components in each grid cell to a dump file every 1000 steps:</p>
<div class="highlight-xorg.conf notranslate"><div class="highlight"><pre><span></span><span class="nb">compute</span> <span class="no">1 grid all u v w</span>
<span class="nb">fix</span> <span class="no">1 ave/grid 10 100 1000 c_1</span>
<span class="nb">compute</span> <span class="no">2 fft/grid f_11 f_12 f_13</span>
<span class="nb">dump</span> <span class="no">1 grid all 1000 tmp.grid id c_2 f_1</span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description:<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Define a computation that performs FFTs on per-grid values. This can be
useful, for example, in calculating the energy spectrum of a turbulent
flow.</p>
<p>The defined grid must be a regular one-level grid (not hierarchical)
with an even number of grid cells in each dimension. Depending on the
<a class="reference internal" href="dimension.html#command-dimension"><span class="std std-ref">dimension</span></a> of the simulation, either 2d or 3d FFTs
will be performed. Because FFTs assume a periodic field, the simulation
domain should be periodic in all dimensions, as set by the
<a class="reference internal" href="boundary.html#command-boundary"><span class="std std-ref">boundary</span></a> command, though SPARTA does not check for
that.</p>
<p>The results of this compute can be used by different commands in
different ways. The values for a single timestep can be output by the
<a class="reference internal" href="dump.html#command-dump"><span class="std std-ref">dump grid</span></a> command. The values over many sampling
timesteps can be averaged by the <a class="reference internal" href="fix_ave_grid.html#command-fix-ave-grid"><span class="std std-ref">fix ave/grid</span></a>
command.</p>
<p>An FFT is performed on each input value independently.</p>
<p>Each listed input can be the result of a <a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute</span></a> or
<a class="reference internal" href="fix.html#command-fix"><span class="std std-ref">fix</span></a> or the evaluation of a <a class="reference internal" href="variable.html#command-variable"><span class="std std-ref">variable</span></a>,
all of which must generate per-grid quantities.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">c_</span></code>, a compute ID must follow which has been
previously defined in the input script. The compute must generate a
per-grid vector or array. See the individual <a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute</span></a>
doc page for details. If no bracketed integer is appended, the vector
calculated by the compute is used. If a bracketed integer is appended,
the Ith column of the array calculated by the compute is used. Users can
also write code for their own compute styles and <a class="reference internal" href="Section_modify.html#modify"><span class="std std-ref">add them to SPARTA</span></a>.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">f_</span></code>, a fix ID must follow which has been
previously defined in the input script. The fix must generate a per-grid
vector or array. See the individual <a class="reference internal" href="fix.html#command-fix"><span class="std std-ref">fix command</span></a> doc page for
details. Note that some fixes only produce their values on certain
timesteps, which must be compatible with when this compute references
the values, else an error results. If no bracketed integer is appended,
the vector calculated by the fix is used. If a bracketed integer is
appended, the Ith column of the array calculated by the fix is used.
Users can also write code for their own fix style and <a class="reference internal" href="Section_modify.html#modify"><span class="std std-ref">add them to SPARTA</span></a>.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">v_</span></code>, a variable name must follow which has been
previously defined in the input script. It must be a <a class="reference internal" href="variable.html#command-variable"><span class="std std-ref">grid-style variable</span></a>. Such a variable defines a formula which can
reference stats keywords or invoke other computes, fixes, or variables
when they are evaluated. So this is a very general means of creating a
per-grid input to perform an FFT on.</p>
<hr class="docutils" />
<p>If the <em>sum</em> keyword is set to <em>yes</em>, the results of all FFTs will be
summed together, grid value by grid value, to create a single output.</p>
<p>The result of each FFT is scaled by the <em>sfactor</em> value of the <em>scale</em>
keyword, whose default is 1.0.</p>
<p>If the <em>conjugate</em> keyword is set to <em>no</em>, the result of each FFT is 2
values for each grid point, the real and imaginary parts of a complex
number. If the <em>conjugate</em> keyword is set to <em>yes</em>, the complex value
for each grid point is multiplied by its complex conjugate to yield a
single real-valued number for each grid point. Note that this value is
effectively the squared length of the complex 2-vector with real and
imaginary components.</p>
<p>If one or more of the <em>kx</em>, <em>ky</em>, <em>kz</em>, or <em>kmag</em> keywords are set to
<em>yes</em>, then one or moer extra columns of per-grid output is generated.
For <em>kx</em> the x-component of the K-space wavevector is generated.
Similarly for <em>ky</em> and <em>kz</em>. For <em>kmag</em> the length of each K-space
wavevector is generated. These values can be useful, for example, for
histogramming an energy spectrum computed from the FFT of a velocity
field, as a function of wavelength or a component of the wavelength.</p>
<p>Note that the wavevector for each grid cell is indexed as (Kx,Ky,Kz).
Those indices are the x,y,z components output by the <em>kx</em>, <em>ky</em>, <em>kz</em>
keywords. The total wavelength, which is output by the <em>kmag</em> keyword,
is sqrt(Kx^2 + Ky^2 + Kz^2) for 3d models and sqrt(Kx^2 + Ky^2) for 2d
models. For all keywords, the Kx,Ky,Kz represent distance from the
origin in a periodic sense. Thus for a grid that is NxMxP, the Kx values
associated with the x-dimension and used in those formulas are not Kx =
0,1,2 … N-2,N-1. Rather they are Kx = 0,1,2, … N/2-1, N/2, N/2-1,
… 2,1. Similary for Ky in the y-dimension with a max index of M/2, and
Kz in the z-dimension with a max index of P/2.</p>
</div>
<hr class="docutils" />
<div class="section" id="output-info">
<h2>Output info:<a class="headerlink" href="#output-info" title="Permalink to this headline">¶</a></h2>
<p>The number of per-grid values ouptut by this compute depends on the
optional keyword settings. The number of FFTs is equal to the number of
specified input values.</p>
<p>There are 2 columns of output per FFT if <em>sum</em> = no and <em>conjugate</em> =
no, with real and imaginary components for each FFT. There is 1 column
of output per FFT if <em>sum</em> = no and <em>conjugate</em> = yes. There are 2
columns of output if <em>sum</em> = yes and <em>conjugate</em> = no, with real and
imaginary components for the sum of all the FFTs. There is one column of
output for <em>sum</em> = yes and <em>conjugate</em> = yes. For all these cases, there
is one extra column of output for each of the <em>kx</em>, <em>ky</em>, <em>kz</em>, <em>kmag</em>
keywords if they are set to <em>yes</em>. The extra columns come before the FFT
columns, in the order <em>kx</em>, <em>ky</em>, <em>kz</em>, <em>kmag</em>. Thus is only <em>ky</em> and
<em>kmag</em> are set to yes, there will be 2 extra columns, the first for <em>ky</em>
and the 2nd for <em>kmag</em>.</p>
<p>If the total number of output columns = 1, then this compute produces a
per-grid vector as output. Otherwise it produces a per-grid array.</p>
<p>This compute performs calculations for all flavors of child grid cells
in the simulation, which includes unsplit, cut, split, and sub cells.
See <a class="reference internal" href="Section_howto.html#howto-grids"><span class="std std-ref">Section</span></a> of the manual gives details of how
SPARTA defines child, unsplit, split, and sub cells. Note that cells
inside closed surfaces contain no particles. These could be unsplit or
cut cells (if they have zero flow volume). Both of these kinds of
cells will compute a zero result for all their values.  Likewise,
split cells store no particles and will produce a zero result.  This
is because their sub-cells actually contain the particles that are
geometrically inside the split cell.</p>
<p>The array can be accessed by any command that uses per-grid values
from a compute as input. See <cite>Section &lt;howto-output&gt;</cite> for an overview
of SPARTA output options.</p>
<p>The per-grid vector or array values will be in the <a class="reference internal" href="units.html#command-units"><span class="std std-ref">units</span></a> appropriate to the FFT operations as described
above. The K-space wavevector magnitudes are effectively unitless,
e.g.  <code class="docutils literal notranslate"><span class="pre">sqrt(Kx^2</span> <span class="pre">+</span> <span class="pre">Ky^2</span> <span class="pre">+</span> <span class="pre">Kz^2)</span></code> where Kx,Ky,Kz are integers. The FFT
values can be real or imaginary or squared values in K-space resulting
from FFTs of per-grid quantities in whatever units the specified input
values represent.</p>
</div>
<div class="section" id="restrictions">
<h2>Restrictions:<a class="headerlink" href="#restrictions" title="Permalink to this headline">¶</a></h2>
<p>This style is part of the FFT package. It is only enabled if SPARTA
was built with that package. See the <a class="reference internal" href="Section_start.html#start-optional-packages"><span class="std std-ref">Getting Started</span></a> section for more info.</p>
</div>
<div class="section" id="related-commands">
<h2>Related commands:<a class="headerlink" href="#related-commands" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="fix_ave_grid.html#command-fix-ave-grid"><span class="std std-ref">fix ave/grid command</span></a>, <a class="reference internal" href="dump.html#command-dump"><span class="std std-ref">dump command</span></a>,
<a class="reference internal" href="compute_grid.html#command-compute-grid"><span class="std std-ref">compute grid command</span></a></p>
</div>
<div class="section" id="default">
<h2>Default:<a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h2>
<p>The option defaults are sum = no, scale = 1.0, conjugate = no, kmag = no.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>