

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fix ave/grid command &mdash; SPARTA 7 May 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                7 May 2020
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>fix ave/grid command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/fix_ave_grid.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fix-ave-grid-command">
<span id="command-fix-ave-grid"></span><h1>fix ave/grid command<a class="headerlink" href="#fix-ave-grid-command" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="fix-ave-grid-kk-command">
<h1>fix ave/grid/kk command<a class="headerlink" href="#fix-ave-grid-kk-command" title="Permalink to this headline">¶</a></h1>
<p><strong>Syntax:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span> <span class="n">ID</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="n">group</span><span class="o">-</span><span class="n">ID</span> <span class="n">Nevery</span> <span class="n">Nrepeat</span> <span class="n">Nfreq</span> <span class="n">value1</span> <span class="n">value2</span> <span class="o">...</span> <span class="n">keyword</span> <span class="n">args</span> <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><p>ID is documented in <a class="reference external" href="fix.html">fix</a> command</p></li>
<li><p>ave/grid = style name of this fix command</p></li>
<li><p>group-ID = group ID for which grid cells to perform calculation on</p></li>
<li><p>Nevery = use input values every this many timesteps</p></li>
<li><p>Nrepeat = # of times to use input values for calculating averages</p></li>
<li><p>Nfreq = calculate averages every this many timesteps zero or more
input values can be listed</p></li>
<li><p>value = c_ID, c_ID[i], f_ID, f_ID[i], v_name</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c_ID</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">vector</span> <span class="p">(</span><span class="ow">or</span> <span class="n">array</span><span class="p">)</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">compute</span> <span class="k">with</span> <span class="n">ID</span>
<span class="n">c_ID</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ith</span> <span class="n">column</span> <span class="n">of</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">array</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">compute</span> <span class="k">with</span> <span class="n">ID</span><span class="p">,</span> <span class="n">I</span> <span class="n">can</span> <span class="n">include</span> <span class="n">wildcard</span> <span class="p">(</span><span class="n">see</span> <span class="n">below</span><span class="p">)</span>
<span class="n">f_ID</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">vector</span> <span class="p">(</span><span class="ow">or</span> <span class="n">array</span><span class="p">)</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">fix</span> <span class="k">with</span> <span class="n">ID</span>
<span class="n">f_ID</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ith</span> <span class="n">column</span> <span class="n">of</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">array</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">fix</span> <span class="k">with</span> <span class="n">ID</span><span class="p">,</span> <span class="n">I</span> <span class="n">can</span> <span class="n">include</span> <span class="n">wildcard</span> <span class="p">(</span><span class="n">see</span> <span class="n">below</span><span class="p">)</span>
<span class="n">v_name</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">vector</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">grid</span><span class="o">-</span><span class="n">style</span> <span class="n">variable</span> <span class="k">with</span> <span class="n">name</span>
</pre></div>
</div>
</li>
<li><p>zero or more keyword/arg pairs may be appended</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">keyword</span> <span class="o">=</span> <span class="n">ave</span>
  <span class="n">ave</span> <span class="n">args</span> <span class="o">=</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">running</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">output</span> <span class="n">a</span> <span class="n">new</span> <span class="n">average</span> <span class="n">value</span> <span class="n">every</span> <span class="n">Nfreq</span> <span class="n">steps</span>
    <span class="n">running</span> <span class="o">=</span> <span class="n">accumulate</span> <span class="n">average</span> <span class="n">continuously</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">1000</span> <span class="n">c_mine</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">1</span> <span class="mi">100</span> <span class="mi">100</span> <span class="n">c_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">ave</span> <span class="n">running</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">1</span> <span class="mi">100</span> <span class="mi">100</span> <span class="n">c_2</span><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">ave</span> <span class="n">running</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="n">section1</span> <span class="mi">5</span> <span class="mi">20</span> <span class="mi">100</span> <span class="n">v_myEng</span>
</pre></div>
</div>
<p>These commands will dump averages for each species and each grid cell to
a file every 1000 steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="mi">1</span> <span class="n">grid</span> <span class="n">species</span> <span class="n">n</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span> <span class="n">usq</span> <span class="n">vsq</span> <span class="n">wsq</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="mi">10</span> <span class="mi">100</span> <span class="mi">1000</span> <span class="n">c_1</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>
<span class="n">dump</span> <span class="mi">1</span> <span class="n">grid</span> <span class="nb">all</span> <span class="mi">1000</span> <span class="n">tmp</span><span class="o">.</span><span class="n">grid</span> <span class="nb">id</span> <span class="n">f_1</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Description:</strong></p>
<p>Use one or more per-grid vectors as inputs every few timesteps, and
average by grid cell over longer timescales, applying appropriate
normalization factors. The resulting per grid cell averages can be used
by other output commands such as the <a class="reference external" href="dump.html">dump grid</a> command.
Only grid cells in the grid group specified by <em>group-ID</em> are included
in the averaging. See the <a class="reference external" href="group.html">group grid</a> command for info
on how grid cells can be assigned to grid groups.</p>
<p>Each input value can be the result of a <a class="reference external" href="compute.html">compute</a> or
<a class="reference external" href="fix.html">fix</a> or <a class="reference external" href="variable.html">grid-style variable</a>. The
compute or fix must produce a per-grid vector or array, not a global or
per-particle or per-surf quantity. If you wish to time-average global
quantities from a compute, fix, or variable, then see the <a class="reference external" href="fix_ave_time.html">fix
ave/time</a> command. To time-average per-surf
quantities, see the <a class="reference external" href="fix_ave_surf.html">fix ave/surf</a> command.</p>
<p>Each per-grid value of each input vector is averaged independently.</p>
<p><a class="reference external" href="compute.html">Computes</a> that produce per-grid vectors or arrays are
those which have the word <em>grid</em> in their style name. See the doc pages
for individual <a class="reference external" href="fix.html">fixes</a> to determine which ones produce
per-grid vectors or arrays.</p>
<p>Note that for values from a compute or fix, the bracketed index I can be
specified using a wildcard asterisk with the index to effectively
specify multiple values. This takes the form “*” or “<em>n” or “n</em>” or
“m*n”. If N = the size of the vector (for <em>mode</em> = scalar) or the number
of columns in the array (for <em>mode</em> = vector), then an asterisk with no
numeric values means all indices from 1 to N. A leading asterisk means
all indices from 1 to n (inclusive). A trailing asterisk means all
indices from n to N (inclusive). A middle asterisk means all indices
from m to n (inclusive).</p>
<p>Using a wildcard is the same as if the individual columns of the array
had been listed one by one. E.g. these 2 fix ave/grid commands are
equivalent, since the <a class="reference external" href="compute_grid.html">compute grid</a> command
creates a per-grid array with 3 columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myGrid</span> <span class="nb">all</span> <span class="nb">all</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">1000</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">10</span> <span class="mi">20</span> <span class="mi">1000</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<hr class="docutils" />
<p>The <em>Nevery</em>, <em>Nrepeat</em>, and <em>Nfreq</em> arguments specify on what timesteps
the input values will be used in order to contribute to the average. The
final averaged quantities are generated on timesteps that are a multiple
of <em>Nfreq</em>. The average is over <em>Nrepeat</em> quantities, computed in the
preceding portion of the simulation every <em>Nevery</em> timesteps. <em>Nfreq</em>
must be a multiple of <em>Nevery</em> and <em>Nevery</em> must be non-zero even if
<em>Nrepeat</em> is 1. Also, the timesteps contributing to the average value
cannot overlap, i.e. Nfreq &gt; (Nrepeat-1)*Nevery is required.</p>
<p>For example, if Nevery=2, Nrepeat=6, and Nfreq=100, then values on
timesteps 90,92,94,96,98,100 will be used to compute the final average
on timestep 100. Similarly for timesteps 190,192,194,196,198,200 on
timestep 200, etc.</p>
<hr class="docutils" />
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">c_</span></code>, a compute ID must follow which has been
previously defined in the input script. If no bracketed term is
appended, and the compute calculates a per-grid vector, then the
per-grid vector is used. If <em>c_ID[I]</em> is used, then I must be in the
range from 1-M, which will use the Ith column of the M-column per-grid
array calculated by the compute. See the discussion above for how I can
be specified with a wildcard asterisk to effectively specify multiple
values.</p>
<p>Users can also write code for their own compute styles and <a class="reference external" href="Section_modify.html">add them to
SPARTA</a>.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">f_</span></code>, a fix ID must follow which has been
previously defined in the input script. If no bracketed term is
appended, and the fix calculates a per-grid vector, then the per-grid
vector is used. If <em>f_ID[I]</em> is used, then I must be in the range from
1-M, which will use the Ith column of the M-column per-grid array
calculated by the fix. See the discussion above for how I can be
specified with a wildcard asterisk to effectively specify multiple
values.</p>
<p>Note that some fixes only produce their values on certain timesteps,
which must be compatible with <em>Nevery</em>, else an error will result. Users
can also write code for their own fix styles and <a class="reference external" href="Section_modify.html">add them to
SPARTA</a>.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">v_</span></code>, a variable name must follow which has been
previously defined in the input script. Only grid-style variables can be
referenced. See the <a class="reference external" href="variable.html">variable</a> command for details.
Note that grid-style variables define a formula which can reference
<a class="reference external" href="stats_style.html">stats_style</a> keywords, or they can invoke other
computes, fixes, or variables when they are evaluated, so this is a very
general means of specifying quantities to time average.</p>
<hr class="docutils" />
<p>For averaging of a value that comes from a compute or fix, normalization
is performed as follows. Note that no normalization is performed on a
value produced by a grid-style variable.</p>
<p>If the compute or fix is summing over particles in a grid cell to
calculate a per-grid quantity (e.g. energy or temperature), this takes
the form of a numerator divided by a denominator. For example, see the
formulas discussed on the <a class="reference external" href="compute_grid.html">compute grid</a> doc page,
where the denominator is 1 (for keyword n), or the number of particles
(ke, mass, temp), or the sum of particle masses (u, usq, etc). When this
command averages over a series of timesteps, the numerator and
denominator are summed separately. This means the numerator/denominator
division only takes place when this fix produces output, every Nfreq
timesteps.</p>
<p>For example, say the Nfreq output is over 2 timesteps, and the value
produced by <a class="reference external" href="compute_grid.html">compute grid mass</a> is being averaged.
Say a grid cell has 10 particles on the 1st timestep with a numerator
value of 10.0, and 100 particles on the 2nd timestep with a numerator
value of 50.0. The output of this fix will be (10+50) / (10+100) = 0.54,
not ((10/10) + (50/100)) / 2 = 0.75.</p>
<hr class="docutils" />
<p>Additional optional keywords also affect the operation of this fix.</p>
<p>The <em>ave</em> keyword determines what happens to the accumulation of
statistics every <em>Nfreq</em> timesteps.</p>
<p>If the <em>ave</em> setting is <em>one</em>, then the values produced on timesteps
that are multiples of Nfreq are independent of each other. Normalization
as described above is performed, and all tallies are zeroed before
accumulating over the next <em>Nfreq</em> steps.</p>
<p>If the <em>ave</em> setting is <em>running</em>, then tallies are never zeroed. Thus
the output at any <em>Nfreq</em> timestep is normalized over all previously
accumulated samples since the fix was defined. The tallies can only be
zeroed by deleting the fix via the unfix command, or by re-defining the
fix, or by re-specifying it.</p>
<hr class="docutils" />
<p><strong>Restart, output info:</strong></p>
<p>No information about this fix is written to <a class="reference external" href="restart.html">binary restart
files</a>.</p>
<p>This fix produces a per-grid vector or array which can be accessed by
various output commands. A vector is produced if only a single quantity
is averaged by this fix. If two or more quantities are averaged, then an
array of values is produced, where the number of columns is the number
of quantities averaged. The per-grid values can only be accessed on
timesteps that are multiples of <em>Nfreq</em> since that is when averaging is
performed.</p>
<p>This fix performs averaging for all child grid cells in the simulation, which includes unsplit, split, and sub cells. <a class="reference internal" href="Section_howto.html#howto-grids"><span class="std std-ref">Details of grid geometry in SPARTA</span></a> of the manual gives details of how SPARTA defines child, unsplit, split, and sub cells.</p>
<p>Grid cells not in the specified <em>group-ID</em> will output zeroes for all their values.</p>
<hr class="docutils" />
<p>Styles with a <em>kk</em> suffix are functionally the same as the corresponding
style without the suffix. They have been optimized to run faster,
depending on your available hardware, as discussed in the <a class="reference external" href="Section_accelerate.html">Accelerating
SPARTA</a> section of the manual. The
accelerated styles take the same arguments and should produce the same
results, except for different random number, round-off and precision
issues.</p>
<p>These accelerated styles are part of the KOKKOS package. They are only
enabled if SPARTA was built with that package. See the <a class="reference external" href="Section_start.html#start_3">Making
SPARTA</a> section for more info.</p>
<p>You can specify the accelerated styles explicitly in your input script
by including their suffix, or you can use the <a class="reference external" href="Section_start.html#start_6">-suffix command-line
switch</a> when you invoke SPARTA, or you
can use the <a class="reference external" href="suffix.html">suffix</a> command in your input script.</p>
<p>See the <a class="reference external" href="Section_accelerate.html">Accelerating SPARTA</a> section of the
manual for more instructions on how to use the accelerated styles
effectively.</p>
<hr class="docutils" />
<p><strong>Restrictions:</strong></p>
<p>If performing on-the-fly grid adaptation every N timesteps, using the
<a class="reference external" href="fix_adapt.html">fix adapt</a> command, this fix cannot time-average
across time windows &gt; N steps, since the grid may change. This means
<em>Nfreq</em> cannot be &gt; N, and keyword <em>ave</em> = <em>running</em> is not allowed.</p>
<p><strong>Related commands:</strong></p>
<p><a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute command</span></a>,
<a class="reference internal" href="fix_ave_time.html#command-fix-ave-time"><span class="std std-ref">fix ave/time command</span></a></p>
<p><strong>Default:</strong></p>
<p>The option defaults are ave = one.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, JF

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>