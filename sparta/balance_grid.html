

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>14.2. balance_grid command &mdash; SPARTA 7 May 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="14.3. bound_modify command" href="bound_modify.html" />
    <link rel="prev" title="14.1. adapt_grid command" href="adapt_grid.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                7 May 2020
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="commands.html">14. List of Commands</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="adapt_grid.html">14.1. adapt_grid command</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">14.2. balance_grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="bound_modify.html">14.3. bound_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="boundary.html">14.4. boundary command</a></li>
<li class="toctree-l2"><a class="reference internal" href="clear.html">14.5. clear command</a></li>
<li class="toctree-l2"><a class="reference internal" href="collide.html">14.6. collide command</a></li>
<li class="toctree-l2"><a class="reference internal" href="collide_modify.html">14.7. collide_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute.html">14.8. compute command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_boundary.html">14.9. compute boundary command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_count.html">14.10. compute count command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_count.html#compute-count-kk-command">14.11. compute count/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_distsurf_grid.html">14.12. compute distsurf/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_eflux_grid.html">14.13. compute eflux/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_eflux_grid.html#compute-eflux-grid-kk-command">14.14. compute eflux/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_fft_grid.html">14.15. compute fft/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_grid.html">14.16. compute grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_grid.html#compute-grid-kk-command">14.17. compute grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_isurf_grid.html">14.18. compute isurf/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_ke_particle.html">14.19. compute ke/particle command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_ke_particle.html#compute-ke-particle-kk-command">14.20. compute ke/particle/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_lambda_grid.html">14.21. compute lambda/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_lambda_grid.html#compute-lambda-grid-kk-command">14.22. compute lambda/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_pflux_grid.html">14.23. compute pflux/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_pflux_grid.html#compute-pflux-grid-kk-command">14.24. compute pflux/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_property_grid.html">14.25. compute property/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_react_boundary.html">14.26. compute react/boundary command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_react_isurf_grid.html">14.27. compute react/isurf/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_react_surf.html">14.28. compute react/surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_reduce.html">14.29. compute reduce command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_sonine_grid.html">14.30. compute sonine/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_sonine_grid.html#compute-sonine-grid-kk-command">14.31. compute sonine/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_surf.html">14.32. compute surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_surf.html#compute-surf-kk-command">14.33. compute surf/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_temp.html">14.34. compute temp command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_temp.html#compute-temp-kk-command">14.35. compute temp/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_thermal_grid.html">14.36. compute thermal/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_thermal_grid.html#compute-thermal-grid-kk-command">14.37. compute thermal/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="compute_tvib_grid.html">14.38. compute tvib/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_box.html">14.39. create_box command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_grid.html">14.40. create_grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_particles.html">14.41. create_particles command</a></li>
<li class="toctree-l2"><a class="reference internal" href="create_particles.html#create-particles-kk-command">14.42. create_particles/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dimension.html">14.43. dimension command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump.html">14.44. dump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_image.html">14.45. dump image command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_image.html#dump-movie-command">14.46. dump movie command</a></li>
<li class="toctree-l2"><a class="reference internal" href="dump_modify.html">14.47. dump_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="echo.html">14.48. echo command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix.html">14.49. fix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ablate.html">14.50. fix ablate command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_adapt.html">14.51. fix adapt command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_adapt.html#fix-adapt-kk-command">14.52. fix adapt/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ambipolar.html">14.53. fix ambipolar command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ave_grid.html">14.54. fix ave/grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ave_grid.html#fix-ave-grid-kk-command">14.55. fix ave/grid/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ave_surf.html">14.56. fix ave/surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_ave_time.html">14.57. fix ave/time command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_balance.html">14.58. fix balance command - fix balance/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_emit_face.html">14.59. fix emit/face command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_emit_face.html#fix-emit-face-kk-command">14.60. fix emit/face/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_emit_face_file.html">14.61. fix emit/face/file command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_emit_surf.html">14.62. fix emit/surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_grid_check.html">14.63. fix grid/check command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_grid_check.html#fix-grid-check-kk-command">14.64. fix grid/check/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_move_surf.html">14.65. fix move/surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_move_surf.html#fix-move-surf-kk-command">14.66. fix move/surf/kk command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_print.html">14.67. fix print command</a></li>
<li class="toctree-l2"><a class="reference internal" href="fix_vibmode.html">14.68. fix vibmode command</a></li>
<li class="toctree-l2"><a class="reference internal" href="global.html">14.69. global command</a></li>
<li class="toctree-l2"><a class="reference internal" href="group.html">14.70. group command</a></li>
<li class="toctree-l2"><a class="reference internal" href="if.html">14.71. if command</a></li>
<li class="toctree-l2"><a class="reference internal" href="include.html">14.72. include command</a></li>
<li class="toctree-l2"><a class="reference internal" href="jump.html">14.73. jump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="label.html">14.74. label command</a></li>
<li class="toctree-l2"><a class="reference internal" href="log.html">14.75. log command</a></li>
<li class="toctree-l2"><a class="reference internal" href="mixture.html">14.76. mixture command</a></li>
<li class="toctree-l2"><a class="reference internal" href="move_surf.html">14.77. move_surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="next.html">14.78. next command</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">14.79. package command</a></li>
<li class="toctree-l2"><a class="reference internal" href="partition.html">14.80. partition command</a></li>
<li class="toctree-l2"><a class="reference internal" href="print.html">14.81. print command</a></li>
<li class="toctree-l2"><a class="reference internal" href="quit.html">14.82. quit command</a></li>
<li class="toctree-l2"><a class="reference internal" href="react.html">14.83. react command</a></li>
<li class="toctree-l2"><a class="reference internal" href="react_modify.html">14.84. react_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_grid.html">14.85. read_grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_isurf.html">14.86. read_isurf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_particles.html">14.87. read_particles command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_restart.html">14.88. read_restart command</a></li>
<li class="toctree-l2"><a class="reference internal" href="read_surf.html">14.89. read_surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="region.html">14.90. region command</a></li>
<li class="toctree-l2"><a class="reference internal" href="remove_surf.html">14.91. remove_surf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="reset_timestep.html">14.92. reset_timestep command</a></li>
<li class="toctree-l2"><a class="reference internal" href="restart.html">14.93. restart command</a></li>
<li class="toctree-l2"><a class="reference internal" href="run.html">14.94. run command</a></li>
<li class="toctree-l2"><a class="reference internal" href="scale_particles.html">14.95. scale_particles command</a></li>
<li class="toctree-l2"><a class="reference internal" href="seed.html">14.96. seed command</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">14.97. shell command</a></li>
<li class="toctree-l2"><a class="reference internal" href="species.html">14.98. species command</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats.html">14.99. stats command</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats_modify.html">14.100. stats_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="stats_style.html">14.101. stats_style command</a></li>
<li class="toctree-l2"><a class="reference internal" href="suffix.html">14.102. suffix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="surf_collide.html">14.103. surf_collide command</a></li>
<li class="toctree-l2"><a class="reference internal" href="surf_modify.html">14.104. surf_modify command</a></li>
<li class="toctree-l2"><a class="reference internal" href="surf_react.html">14.105. surf_react command</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestep.html">14.106. timestep command</a></li>
<li class="toctree-l2"><a class="reference internal" href="uncompute.html">14.107. uncompute command</a></li>
<li class="toctree-l2"><a class="reference internal" href="undump.html">14.108. undump command</a></li>
<li class="toctree-l2"><a class="reference internal" href="unfix.html">14.109. unfix command</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html">14.110. units command</a></li>
<li class="toctree-l2"><a class="reference internal" href="variable.html">14.111. variable command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_grid.html">14.112. write_grid command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_isurf.html">14.113. write_isurf command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_restart.html">14.114. write_restart command</a></li>
<li class="toctree-l2"><a class="reference internal" href="write_surf.html">14.115. write_surf command</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="commands.html">14. List of Commands</a> &raquo;</li>
        
      <li>14.2. balance_grid command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/balance_grid.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="balance-grid-command">
<span id="command-balance-grid"></span><span id="index-0"></span><h1>14.2. balance_grid command<a class="headerlink" href="#balance-grid-command" title="Permalink to this headline">¶</a></h1>
<p><strong>Syntax:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">balance_grid</span> <span class="n">style</span> <span class="n">args</span> <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><p>style = <em>none</em> or <em>stride</em> or <em>clump</em> or <em>block</em> or <em>random</em> or
<em>proc</em> or <em>rcb</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">none</span> <span class="n">args</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">stride</span> <span class="n">args</span> <span class="o">=</span> <span class="n">xyz</span> <span class="ow">or</span> <span class="n">xzy</span> <span class="ow">or</span> <span class="n">yxz</span> <span class="ow">or</span> <span class="n">yzx</span> <span class="ow">or</span> <span class="n">zxy</span> <span class="ow">or</span> <span class="n">zyx</span>
<span class="n">clump</span> <span class="n">args</span> <span class="o">=</span> <span class="n">xyz</span> <span class="ow">or</span> <span class="n">xzy</span> <span class="ow">or</span> <span class="n">yxz</span> <span class="ow">or</span> <span class="n">yzx</span> <span class="ow">or</span> <span class="n">zxy</span> <span class="ow">or</span> <span class="n">zyx</span>
<span class="n">block</span> <span class="n">args</span> <span class="o">=</span> <span class="n">Px</span> <span class="n">Py</span> <span class="n">Pz</span>
  <span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span> <span class="o">=</span> <span class="c1"># of processors in each dimension</span>
<span class="n">random</span> <span class="n">args</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">proc</span> <span class="n">args</span> <span class="o">=</span> <span class="n">none</span>
<span class="n">rcb</span> <span class="n">args</span> <span class="o">=</span> <span class="n">weight</span>
  <span class="n">weight</span> <span class="o">=</span> <span class="n">cell</span> <span class="ow">or</span> <span class="n">part</span> <span class="ow">or</span> <span class="n">time</span>
</pre></div>
</div>
</li>
<li><p>zero or more keyword/value(s) pairs may be appended</p></li>
<li><p>keyword = <em>axes</em> or <em>flip</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">axes</span> <span class="n">value</span> <span class="o">=</span> <span class="n">dims</span>
  <span class="n">dims</span> <span class="o">=</span> <span class="n">string</span> <span class="k">with</span> <span class="nb">any</span> <span class="n">of</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="ow">or</span> <span class="s2">&quot;z&quot;</span> <span class="n">characters</span> <span class="ow">in</span> <span class="n">it</span>
<span class="n">flip</span> <span class="n">value</span> <span class="o">=</span> <span class="n">yes</span> <span class="ow">or</span> <span class="n">no</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">balance_grid</span> <span class="n">block</span> <span class="o">*</span> <span class="o">*</span> <span class="o">*</span>
<span class="n">balance_grid</span> <span class="n">block</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span>
<span class="n">balance_grid</span> <span class="n">clump</span> <span class="n">yxz</span>
<span class="n">balance_grid</span> <span class="n">random</span>
<span class="n">balance_grid</span> <span class="n">rcb</span> <span class="n">part</span>
<span class="n">balance_grid</span> <span class="n">rcb</span> <span class="n">part</span> <span class="n">axes</span> <span class="n">xz</span>
</pre></div>
</div>
<p><strong>Description:</strong></p>
<p>This command adjusts the assignment of grid cells and their particles to
processors, to attempt to balance the computational cost (load) evenly
across processors. The load balancing is “static” in the sense that this
command performs the balancing once, before or between simulations. The
assignments will remain static during the subsequent run. To perform
“dynamic” balancing, see the <a class="reference external" href="fix_balance.html">fix balance</a> command,
which can adjust the assignemt of grid cells to processors on-the-fly
during a run.</p>
<p>After grid cells have been assigned, they are migrated to new owning
processors, along with any particles they own or other per-cell
attributes stored by fixes. The internal data structures within SPARTA
for grid cells and particles are re-initialized with the new
decomposition.</p>
<p>This command can be used immediately after the grid is created, via the
<a class="reference external" href="create_grid.html">create_grid</a> or
<a class="reference external" href="read_restart.html">read_restart</a> commands. In the former case
balance_grid can be used to partition the grid in a more desirable
manner than the default creation options allow for. In the latter case,
balance grid can be used to change the somewhat random assignment of
grid cells to processors that will be made if the restart file is read
by a different number of processors than it was written by.</p>
<p>This command can also be used once particles have been created, or a
simulation has come to equilibrium with a spatially varying density
distribution of particles, so that the computational load is more evenly
balanced across processors.</p>
<p>The details of how child cells are assigned to processors by the various
options of this command are described below. The cells assigned to each
processor will either be “clumped” or “dispersed”.</p>
<p>The <em>clump</em> and <em>block</em> and <em>rcb</em> styles will produce clumped
assignments of child cells to each processor. This means each
processor’s cells will be geometrically compact. The <em>stride</em> and
<em>random</em> and <em>proc</em> styles will produce dispersed assignments of child
cells to each processor.</p>
<p>IMPORTANT NOTE: See <a class="reference external" href="Section_howto.html#howto_8">Section 6.8</a> of the
manual for an explanation of clumped and dispersed grid cell assignments
and their relative performance trade-offs.</p>
<hr class="docutils" />
<p>The <em>none</em> style will not change the assignment of grid cells to
processors. However it will update the internal data structures within
SPARTA that store ghost cell information on each processor for cells
owned by other processors. This is useful if the <a class="reference external" href="global.html">global
gridcut</a> command was used after grid cells were already
defined. That command erases ghost cell information stored by
processors, which then needs to be re-generated before a simulation is
run. Using the balance_grid none command will re-generate the ghost cell
information.</p>
<p>The <em>stride</em>, <em>clump</em>, and <em>block</em> styles can only be used if the grid
is “uniform”. The grid in SPARTA is hierarchical with one or more
levels, as defined by the <a class="reference external" href="create_grid.html">create_grid</a> or
<a class="reference external" href="read_grid.html">read_grid</a> commlands. If the parent cell of every
grid cell is at the same level of the hierarchy, then for puposed os
this command the grid is uniform, meaning the collection of grid cells
effectively form a uniform fine grid overlaying the entire simulation
domain.</p>
<p>The meaning of the <em>stride</em>, <em>clump</em>, and <em>block</em> styles is exactly the
same as when they are used as keywords with the
<a class="reference external" href="create_grid.html">create_grid</a> command. See its doc page for
details.</p>
<p>The <em>random</em> style means that each grid cell will be assigned randomly
to one of the processors. Note that in this case every processor will
typically not be assigned the exact same number of cells.</p>
<p>The <em>proc</em> style means that each processor will choose a random
processor to assign its first grid cell to. It will then loop over its
grid cells and assign each to consecutive processors, wrapping around
the enumeration of processors if necessary. Note that in this case every
processor will typically not be assigned exactly the same number of
cells.</p>
<p>The <em>rcb</em> style uses a recursive coordinate bisectioning (RCB) algorithm
to assign spatially-compact clumps of grid cells to processors. Each
grid cell has a “weight” in this algorithm so that each processor is
assigned an equal total weight of grid cells, as nearly as possible.</p>
<p>If the <em>weight</em> argument is specified as <em>cell</em>, then the weight for
each grid cell is 1.0, so that each processor will end up with an equal
number of grid cells.</p>
<p>If the <em>weight</em> argument is specified as <em>part</em>, then the weight for
each grid cell is the number of particles it currently owns, so that
each processor will end up with an equal number of particles.</p>
<p>If the <em>weight</em> argument is specified as <em>time</em>, then timers are used to
estimate the cost of each grid cell. The cost from the timers is given
on a per processor basis, and then assigned to grid cells by weighting
by the relative number of particles in the grid cells. If no timing data
has yet been collected at the point in a script where this command is
issued, a <em>cell</em> style weight will be used instead of <em>time</em>. A small
warmup run (for example 100 timesteps) can be used before the balance
command so that timer data is available. The timers used for balancing
tally time from the move, sort, collide, and modify portions of each
timestep.</p>
<p>Here is an example of an RCB partitioning for 24 processors, of a 2d
hierarchical grid with 5 levels, refined around a tilted ellipsoidal
surface object (outlined in pink). This is for a <em>weight cell</em> setting,
yielding an equal number of grid cells per processor. Each processor is
assigned a different color of grid cells. (Note that less colors than
processors were used, so the disjoint yellow cells actually belong to
three different processors). This is an example of a clumped
distribution where each processor’s assigned cells can be compactly
bounded by a rectangle. Click for a larger version of the image.</p>
<p><a class="reference external" href="JPG/partition.jpg"><img alt="image0" src="_images/partition_small.jpg" /></a></p>
<hr class="docutils" />
<p>The optional keywords <em>axes</em> and <em>flip</em> only apply to the <em>rcb</em> style.
Otherwise they are ignored.</p>
<p>The <em>axes</em> keyword allows limiting the partitioning created by the RCB
algorithm to a subset of dimensions. The default is to allow cuts in all
dimension, e.g. x,y,z for 3d simulations. The dims value is a string
with 1, 2, or 3 characters. The characters must be one of “x”, “y”, or
“z”. They can be in any order and must be unique. For example, in 3d, a
dims = xz would only partition the 3d grid only in the x and z
dimensions.</p>
<p>The <em>flip</em> keyword is useful for debugging. If it is set to <em>yes</em> then
each time an RCB partitioning is done, the coordinates of grid cells
will (internally only) undergo a sign flip to insure that the new owner
of each grid cell is a different processor than the previous owner, at
least when more than a few processors are used. This will insure all
particle and grid data moves to new processors, fully exercising the
rebalancing code.</p>
<hr class="docutils" />
<p><strong>Restrictions:</strong></p>
<p>This command can only be used after the grid has been created by the
<a class="reference external" href="create_grid.html">create_grid</a>, <a class="reference external" href="read_grid">read_grid</a>, or
<a class="reference external" href="read_restart.html">read_restart</a> commands.</p>
<p>This command also initializes various options in SPARTA before
performing the balancing. This is so that grid cells are ready to
migrate to new processors. Thus if an error is flagged, e.g. that a
simulation box boundary condition is not yet assigned, that operation
needs to be performed in the input script before balancing can be
performed.</p>
<p><strong>Related commands:</strong></p>
<p><a class="reference internal" href="fix_balance.html#command-fix-balance"><span class="std std-ref">fix balance command - fix balance/kk command</span></a></p>
<p><strong>Default:</strong></p>
<p>The default settings for the optional keywords are axes = xyz, flip =
no.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bound_modify.html" class="btn btn-neutral float-right" title="14.3. bound_modify command" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="adapt_grid.html" class="btn btn-neutral float-left" title="14.1. adapt_grid command" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>