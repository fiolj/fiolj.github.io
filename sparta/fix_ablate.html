

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>fix ablate command &mdash; SPARTA 7 May 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                7 May 2020
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
  
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>

            
          
  <a href= "genindex.html">Index</a>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>fix ablate command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/fix_ablate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="fix-ablate-command">
<span id="command-fix-ablate"></span><span id="index-0"></span><h1>fix ablate command<a class="headerlink" href="#fix-ablate-command" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Syntax:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span> <span class="n">ID</span> <span class="n">ablate</span> <span class="n">group</span><span class="o">-</span><span class="n">ID</span> <span class="n">Nevery</span> <span class="n">scale</span> <span class="n">source</span> <span class="n">maxrandom</span>
</pre></div>
</div>
<ul>
<li><p>ID is documented in <a class="reference internal" href="fix.html#command-fix"><span class="std std-ref">fix</span></a> command</p></li>
<li><p>ablate = style name of this fix command</p></li>
<li><p>group-ID = ID of group of grid cells that contain implicit surfaces</p></li>
<li><p>Nevery = perform ablation once every Nevery steps</p></li>
<li><p>scale = scale factor to convert source to grid corner point value
decrement</p></li>
<li><p>source = computeID or fixID or random</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">computeID</span> <span class="o">=</span> <span class="n">c_ID</span> <span class="ow">or</span> <span class="n">c_ID</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="n">compute</span> <span class="n">that</span> <span class="n">calculates</span> <span class="n">per</span> <span class="n">grid</span> <span class="n">cell</span> <span class="n">values</span>
<span class="n">fixID</span> <span class="o">=</span> <span class="n">f_ID</span> <span class="ow">or</span> <span class="n">f_ID</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="n">fix</span> <span class="n">that</span> <span class="n">calculates</span> <span class="n">per</span> <span class="n">grid</span> <span class="n">cell</span> <span class="n">values</span>
<span class="n">random</span> <span class="o">=</span> <span class="n">perform</span> <span class="n">a</span> <span class="n">random</span> <span class="n">decrement</span>
</pre></div>
</div>
</li>
<li><p>maxrandom = maximum per grid cell decrement as an integer (only
specified if source = random)</p></li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fix</span> <span class="mi">1</span> <span class="n">ablate</span> <span class="n">surfcells</span> <span class="mi">0</span> <span class="mf">0.0</span> <span class="n">random</span> <span class="mi">10</span>
<span class="n">fix</span> <span class="mi">1</span> <span class="n">ablate</span> <span class="n">surfcells</span> <span class="mi">1000</span> <span class="mf">10.0</span> <span class="n">c_tally</span>
</pre></div>
</div>
<p><strong>Description:</strong></p>
<p>Perform ablation once every Nevery steps on a set of grid cell corner
points to induce new implicit surface elements in those grid cells. This
command is also used as an argument to the
<a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command so that the grid corner point
values it reads from a file can be assigned to and stored by each grid
cell.</p>
<p>Here are simulation snapshots of 2d and 3d implicit surface models
through which particles flow. Click on any image for a larger image. The
1st and 3rd images are the initial states of the porous media. The 2nd
and 4th images are snapshots midway through an ablation simulation. In
the 2d case, the colorings are by processor for sub-domains each owns.
Particles flow from left to right. The implicit triangles for the 3d
case were created via Marching Cubes (discussed on the
<a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command doc page) from a tomographic
image of a sample of NASA FiberForm (TM) material, used as a heat shield
material on spacecraft. Particles flow from top to bottom.</p>
<p><a class="reference external" href="JPG/porous2d_initial.png"><img alt="image0" src="_images/porous2d_initial_small.png" /></a><a class="reference external" href="JPG/porous2d_ablated.png"><img alt="image1" src="_images/porous2d_ablated_small.png" /></a><a class="reference external" href="JPG/porous3d_initial.png"><img alt="image2" src="_images/porous3d_initial_small.png" /></a><a class="reference external" href="JPG/porous3d_ablated.png"><img alt="image3" src="_images/porous3d_ablated_small.png" /></a></p>
<p>The specified <em>group-ID</em> must be the name of a grid cell group, as
defined by the <a class="reference internal" href="group.html#command-group"><span class="std std-ref">group grid</span></a> command, which contains a set
of grid cells, all of which are the same size, and which comprise a
contiguous 3d array. It must be the same as group-ID used with the
<a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command, which specifies its <em>Nx</em> by
<em>Ny</em> by <em>Nz</em> extent. See the <a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command
for more details. This command reads the initial values for grid cell
corner points, which are stored by this fix.</p>
<p>The specfied <em>Nevery</em> determines how often an ablation operation is
performed. If <em>Nevery</em> = 0, ablation is never performed. The grid cell
corner point values and the surface elements they induce will remain
static for the duration of subsequent simulations.</p>
<p>The specified <em>scale</em> is a pre-factor on the specified <em>source</em> of
ablation strength. It converts the per grid cell numeric quantities
produced by the <em>source</em> (which may have associated units) to a unitless
decrement value for the grid cell corner points, which range from 0 to
255 inclusive. A value of 255 represents solid material and a value of 0
is void (flow volume for particles). Values in between represent
partially ablated material.</p>
<p>The <em>source</em> can be specified as a per grid cell quantity calculated by
a compute, such as <a class="reference internal" href="compute_isurf_grid.html#command-compute-isurf-grid"><span class="std std-ref">compute isurf/grid</span></a>,
e.g. the number of collisions of particles with the surfaces in each
grid cell or the amount of energy transferred to the surface by the
collisions. It can also be specified a per grid cell quantity calculated
by a fix, such as <a class="reference internal" href="fix_ave_grid.html#command-fix-ave-grid"><span class="std std-ref">fix ave/grid</span></a>. That fix could
time average per-grid cell quantities from per grid cell computes. In
that case the <em>scale</em> factor should account for applying a time-averaged
quantity at an interval of <em>N</em> steps.</p>
<p>For debugging purposes, the <em>source</em> can also be specified as <em>random</em>
with an additional integer <em>maxrandom</em> value also specified. In this
case, the <em>scale</em> factor should be floating point value between 0.0 and
1.0. Each time ablation is performed, two random numbers are generated
for each grid cell. The first is a random value between 0.0 and 1.0. The
second is a random integer between 1 and maxrandom. If the first random
# &lt; <em>scale</em>, then the second random integer is the decrement value for
the cell. Thus <em>scale</em> is effectively the fraction of grid cells whose
corner point values are decremented.</p>
<hr class="docutils" />
<p>Here is an example of commands that will couple ablation to surface
reaction statistics to modulate ablation of a set of implicit surfaces.
These lines are taken from the
examples/ablation/in.ablation.3d.reactions input script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">surf_collide</span>       <span class="mi">1</span> <span class="n">diffuse</span> <span class="mf">300.0</span> <span class="mf">1.0</span>
<span class="n">surf_react</span>      <span class="mi">2</span> <span class="n">prob</span> <span class="n">air</span><span class="o">.</span><span class="n">surf</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span>             <span class="mi">10</span> <span class="n">react</span><span class="o">/</span><span class="n">isurf</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">2</span>
<span class="n">fix</span>                 <span class="mi">10</span> <span class="n">ave</span><span class="o">/</span><span class="n">grid</span> <span class="nb">all</span> <span class="mi">1</span> <span class="mi">100</span> <span class="mi">100</span> <span class="n">c_10</span><span class="o">*</span>
<span class="n">dump</span>                <span class="mi">10</span> <span class="n">grid</span> <span class="nb">all</span> <span class="mi">100</span> <span class="n">tmp</span><span class="o">.</span><span class="n">grid</span> <span class="nb">id</span> <span class="n">c_101</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">global</span>              <span class="n">surfs</span> <span class="n">implicit</span>
<span class="n">fix</span>                 <span class="n">ablate</span> <span class="n">ablate</span> <span class="nb">all</span> <span class="mi">100</span> <span class="mf">2.0</span> <span class="n">c_101</span>   <span class="c1"># could be f_10</span>
<span class="n">read_isurf</span>          <span class="nb">all</span> <span class="mi">20</span> <span class="mi">20</span> <span class="mi">20</span> <span class="n">binary</span><span class="o">.</span><span class="mi">21</span><span class="n">x21x21</span> <span class="mf">99.5</span> <span class="n">ablate</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">surf_modify</span>         <span class="nb">all</span> <span class="n">collide</span> <span class="mi">1</span> <span class="n">react</span> <span class="mi">2</span>
</pre></div>
</div>
<p>The order of these commands matter, so here is the explanation.</p>
<p>The <a class="reference internal" href="surf_modify.html#command-surf-modify"><span class="std std-ref">surf_modify</span></a> command must come after the
<a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command, because surfaces must exist
before assigning collision and reaction models to them. The <a class="reference internal" href="#command-fix-ablate"><span class="std std-ref">fix ablate</span></a> command must come before the
<a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command, since it uses the ID of the
<a class="reference internal" href="#command-fix-ablate"><span class="std std-ref">fix ablate command</span></a> as an argument to create implicit
surfaces. The <a class="reference internal" href="#command-fix-ablate"><span class="std std-ref">fix ablate command</span></a> takes a compute
or fix as an argument, in this case the ID of the <a class="reference internal" href="compute_react_isurf_grid.html#command-compute-react-isurf-grid"><span class="std std-ref">compute react/isurf/grid</span></a> command. This is to
specify what calculation drives the ablation. In this case, it is the
<a class="reference internal" href="compute_react_isurf_grid.html#command-compute-react-isurf-grid"><span class="std std-ref">compute react/isurf/grid</span></a> command (or
could be the <a class="reference internal" href="fix_ave_grid.html#command-fix-ave-grid"><span class="std std-ref">fix ave/grid</span></a> command) which tallies
counts of surface reactions for implicit triangles in each grid cell.
The <a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute react/isurf/grid</span></a> react/isurf/grid command
requires the ID of a surface reaction model, so that it knows the list
of possible reactions to tally. In this case the reaction is set by the
<a class="reference internal" href="surf_react.html#command-surf-react"><span class="std std-ref">surf_react</span></a> command, which must therefore comes
near the beginning of this list of commands.</p>
<hr class="docutils" />
<p>As explained on the <a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> doc page, the
marching cubes (3d) or marching squares (2d) algorithm is used to
convert a set of grid corner point values to a set of implicit triangles
in each grid cell which represent the current surface of porous material
which is undergoing dynamic ablation. This uses a threshold value,
defined by the <a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command, to set the
boundary between solid material and void.</p>
<p>The ablation operation decrements the corner point values of each grid
cell containing porous material. The marching cubes or squares algorithm
is re-invoked on the new corner point values to create a new set of
implicit surfaces, which effectively recess due to the decrement
produced byt the ablative <em>source</em> factor.</p>
<p>The manner in which the per-grid source decrement value is applied to
the grid corner points is as follows. Note that each grid cell has 4
(2d) or 8 (3d) corner point values. Except at the boundary of the 2d of
3d array of grid cells containing porous materials, each corner point is
similarly shared by 4 (2d) or 8 (3d) grid cells.</p>
<p>Within each grid cell, the decrement value is subtracted from the
smallest corner point value. Except that a corner point value cannot
become smaller than 0.0. If this would occur, only a portion of the
decrement is used to set the corner point to 0.0; the remainder is
applid to the next smallest corner point value. And so forth on
successive corner points until all of the decrement is used.</p>
<p>The amount of decrement applied to each corner point is next shared
between all the grid cells (4 or 8) sharing each corner point value. The
sum of those decrements is subtracted from the corner point, except that
itâs final value is set no smaller than 0.0. All the copies of each
corner point value are now identical.</p>
<p>Finally, no corner point value can be nearly equal to the marching
cubes/squares threshold value, else line segments or triangles of zero
or epsilon size will result. So corner points with values X where
thresh-epsilon &lt; X &lt; thresh+epsilon are reset to thresh-epsilon. Thresh
is defined by the <a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf</span></a> command. Epsilon is
set to 1.0e-4 in src/fix_ablate.cpp. Note that this is on the scale of
corner point values from 0 to 255.</p>
<hr class="docutils" />
<p><strong>Restart, output info:</strong></p>
<p>No information about this fix is written to <a class="reference internal" href="restart.html#command-restart"><span class="std std-ref">binary restart files</span></a>.</p>
<p>This fix computes a global scalar and a global vector of length 2. The
global scalar is the current sum of unique corner point values across
the entire grid (not counting duplicate values). This sum assumes that
corner point values are 0.0 on the boundary of the 2d or 3d array of
grid cells containing implicit surface elements.</p>
<p>The 2 vector values are the (1) sum of decrement values for each grid
cell in the most recent ablation operation, and (2) the # of particles
deleted during the most recent ablation operation that ended up âinsideâ
the newly ablated surface. The latter quantity should be 0. A non-zero
value indicates a corner case in the marching cubes or marching squares
algorithm the developers still need to address.</p>
<p>These values can be accessed by any command that uses global values from
a fix as input. See <a class="reference internal" href="Section_howto.html#howto-output"><span class="std std-ref">Section 6.4</span></a> for an
overview of SPARTA output options.</p>
<p>The scalar and vector values are unitless.</p>
<p><strong>Restrictions:</strong></p>
<p>This fix can only be used in simulations that define implicit surfaces.</p>
<p><strong>Related commands:</strong></p>
<p><a class="reference internal" href="read_isurf.html#command-read-isurf"><span class="std std-ref">read_isurf command</span></a></p>
<p><strong>Default:</strong> none</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>