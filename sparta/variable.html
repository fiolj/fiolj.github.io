

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>variable command &mdash; SPARTA 7 May 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>variable command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/variable.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="variable-command">
<span id="command-variable"></span><h1>variable command<a class="headerlink" href="#variable-command" title="Permalink to this headline">¶</a></h1>
<p><strong>Syntax:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">name</span> <span class="n">style</span> <span class="n">args</span> <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><p>name = name of variable to define</p></li>
<li><p>style = <em>delete</em> or <em>index</em> or <em>loop</em> or <em>world</em> or <em>universe</em> or
<em>uloop</em> or <em>string</em> or <em>format</em> or <em>getenv</em> or <em>file</em> or <em>internal</em>
or <em>equal</em> or <em>particle</em> or <em>grid</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>delete = no args
index args = one or more strings
loop args = N
  N = integer size of loop, loop from 1 to N inclusive
loop args = N pad
  N = integer size of loop, loop from 1 to N inclusive
  pad = all values will be same length, e.g. 001, 002, ..., 100
loop args = N1 N2
  N1,N2 = loop from N1 to N2 inclusive
loop args = N1 N2 pad
  N1,N2 = loop from N1 to N2 inclusive
  pad = all values will be same length, e.g. 050, 051, ..., 100
world args = one string for each partition of processors
universe args = one or more strings
uloop args = N
  N = integer size of loop
uloop args = N pad
  N = integer size of loop
  pad = all values will be same length, e.g. 001, 002, ..., 100
string arg = one string
format args = vname fstr
  vname = name of equal-style variable to evaluate
  fstr = C-style format string
getenv arg = one string
file arg = filename
internal arg = numeric value
equal or particle or grid args = one formula containing numbers, stats keywords, math operations, particle vectors, compute/fix/variable references
  numbers = 0.0, 100, -5.4, 2.8e-4, etc
  constants = PI
  stats keywords = step, np, vol, etc from stats_style
  math operators = (), -x, x+y, x-y, x*y, x/y, x^y, x%y,
                   x==y, x!=y, xy, x&gt;=y, x&amp;&amp;y, x||y, !x
  math functions = sqrt(x), exp(x), ln(x), log(x), abs(x),
                   sin(x), cos(x), tan(x), asin(x), acos(x), atan(x), atan2(y,x),
                   random(x,y), normal(x,y), ceil(x), floor(x), round(x)
                   ramp(x,y), stagger(x,y), logfreq(x,y,z), stride(x,y,z), vdisplace(x,y), swiggle(x,y,z), cwiggle(x,y,z)
  special functions = sum(x), min(x), max(x), ave(x), trap(x), slope(x), next(x)
  particle vector = mass, type, x, y, z, vx, vy, vz
  compute references = c_ID, c_ID[i], c_ID[i][j]
  fix references = f_ID, f_ID[i], f_ID[i][j]
  surface collision model references = s_ID[i]
  surface reaction model references = r_ID[i]
  variable references = v_name
</pre></div>
</div>
</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>variable x index run1 run2 run3 run4 run5 run6 run7 run8
variable LoopVar loop $n
variable beta equal temp/3.0
variable beta equal &quot;temp / 3.0&quot;
variable b equal c_myTemp
variable b particle x*y/vol
variable foo string myfile
variable foo internal 3.5
variable f file values.txt
variable temp world 300.0 310.0 320.0 ${Tfinal}
variable x universe 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
variable x uloop 15 pad
variable str format x %.6g
variable x delete
</pre></div>
</div>
<p><strong>Description:</strong></p>
<p>This command assigns one or more strings to a variable name for
evaluation later in the input script or during a simulation.</p>
<p>Variables can thus be useful in several contexts. A variable can be
defined and then referenced elsewhere in an input script to become part
of a new input command. For variable styles that store multiple strings,
the <a class="reference external" href="next.html">next</a> command can be used to increment which string
is assigned to the variable. Variables of style <em>equal</em> store a formula
which when evaluated produces a single numeric value which can be output
either directly (see the <a class="reference external" href="print.html">print</a>, <a class="reference external" href="fix_print.html">fix
print</a>, and <a class="reference external" href="run.html">run every</a> commands) or as
part of statistical output (see the <a class="reference external" href="stats_style.html">stats_style</a>
command), or used as input to an averaging fix (see the <a class="reference external" href="fix_ave_time.html">fix
ave/time</a> command). Variables of style <em>particle</em>
store a formula which when evaluated produces one numeric value per
particle which can be output to a dump file (see the <a class="reference external" href="dump.html">dump
particle</a> command). Variables of style <em>internal</em> are used
by a few commands which set their value directly.</p>
<p>In the discussion that follows, the “name” of the variable is the
arbitrary string that is the 1st argument in the variable command. This
name can only contain alphanumeric characters and underscores. The
“string” is one or more of the subsequent arguments. The “string” can be
simple text as in the 1st example above, it can contain other variables
as in the 2nd example, or it can be a formula as in the 3rd example. The
“value” is the numeric quantity resulting from evaluation of the string.
Note that the same string can generate different values when it is
evaluated at different times during a simulation.</p>
<p>IMPORTANT NOTE: When an input script line is encountered that defines a
variable of style <em>equal</em> or <em>particle</em> or <em>grid</em> that contains a
formula, the formula is NOT immediately evaluated and the result stored.
See the discussion below about “Immediate Evaluation of Variables” if
you want to do this. This is also true of the <em>format</em> style variable
since it evaluates another variable when it is invoked.</p>
<p>Variables of style <em>equal</em> and <em>particle</em> and <em>grid</em> can be used as
inputs to various other commands which evaluate their formulas as
needed, e.g. at different timesteps during a <a class="reference external" href="run.html">run</a>.</p>
<p>Variables of style <em>internal</em> can be used in place of an equal-style
variable, except by commands that set the value stored by the
internal-style variable. Thus any command that states it can use an
equal-style variable as an argument, can also use an internal-style
variable. This means that when the command evaluates the variable, it
will use the value set (internally) by another command.</p>
<p>IMPORTANT NOTE: When a variable command is encountered in the input
script and the variable name has already been specified, the command is
ignored. This means variables can NOT be re-defined in an input script
(with 2 exceptions, read further). This is to allow an input script to
be processed multiple times without resetting the variables; see the
<a class="reference external" href="jump.html">jump</a> or <a class="reference external" href="include.html">include</a> commands. It also
means that using the <a class="reference external" href="Section_start.html#start_6">command-line
switch</a> -var will override a
corresponding index variable setting in the input script.</p>
<p>There are two exceptions to this rule. First, variables of style
<em>string</em>, <em>getenv</em>, <em>internal</em>, <em>equal</em>, and <em>particle</em> ARE redefined
each time the command is encountered. This allows these style of
variables to be redefined multiple times in an input script. In a loop,
this means the formula associated with an <em>equal</em> or <em>particle</em> style
variable can change if it contains a substitution for another variable,
e.g. $x or v_x.</p>
<p>Second, as described below, if a variable is iterated on to the end of
its list of strings via the <a class="reference external" href="next.html">next</a> command, it is removed
from the list of active variables, and is thus available to be
re-defined in a subsequent variable command. The <em>delete</em> style does the
same thing.</p>
<hr class="docutils" />
<p><a class="reference external" href="Section_commands.html#cmd_2">Section 3.2</a> of the manual explains how
occurrences of a variable name in an input script line are replaced by
the variable’s string. The variable name can be referenced as $x if the
name “x” is a single character, or as ${LoopVar} if the name “LoopVar”
is one or more characters.</p>
<p>As described below, for variable styles <em>index</em>, <em>loop</em>, <em>universe</em>, and
<em>uloop</em>, which string is assigned to a variable can be incremented via
the <a class="reference external" href="next.html">next</a> command. When there are no more strings to
assign, the variable is exhausted and a flag is set that causes the next
<a class="reference external" href="jump.html">jump</a> command encountered in the input script to be
skipped. This enables the construction of simple loops in the input
script that are iterated over and then exited from.</p>
<p>As explained above, an exhausted variable can be re-used in an input
script. The <em>delete</em> style also removes the variable, the same as if it
were exhausted, allowing it to be redefined later in the input script or
when the input script is looped over. This can be useful when breaking
out of a loop via the <a class="reference external" href="if.html">if</a> and <a class="reference external" href="jump.html">jump</a> commands
before the variable would become exhausted. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">label</span>      <span class="n">loop</span>
<span class="n">variable</span>    <span class="n">a</span> <span class="n">loop</span> <span class="mi">5</span>
<span class="nb">print</span>       <span class="s2">&quot;A = $a&quot;</span>
<span class="k">if</span>      <span class="s2">&quot;$a &gt; 2&quot;</span> <span class="n">then</span> <span class="s2">&quot;jump in.script break&quot;</span>
<span class="nb">next</span>        <span class="n">a</span>
<span class="n">jump</span>        <span class="ow">in</span><span class="o">.</span><span class="n">script</span> <span class="n">loop</span>
<span class="n">label</span>       <span class="k">break</span>
<span class="n">variable</span>    <span class="n">a</span> <span class="n">delete</span>
</pre></div>
</div>
<hr class="docutils" />
<p>This section describes how various variable styles are defined and what
they store. Many of the styles store one or more strings. Note that a
single string can contain spaces (multiple words), if it is enclosed in
quotes in the variable command. When the variable is substituted for in
another input script command, its returned string will then be
interpreted as multiple arguments in the expanded command.</p>
<p>For the <em>index</em> style, one or more strings are specified. Initially, the
1st string is assigned to the variable. Each time a <a class="reference external" href="next.html">next</a>
command is used with the variable name, the next string is assigned. All
processors assign the same string to the variable.</p>
<p><em>Index</em> style variables with a single string value can also be set by
using the command-line switch -var; see <a class="reference external" href="Section_start.html#start_6">Section
2.6</a> of the manual for details.</p>
<p>The <em>loop</em> style is identical to the <em>index</em> style except that the
strings are the integers from 1 to N inclusive, if only one argument N
is specified. This allows generation of a long list of runs (e.g. 1000)
without having to list N strings in the input script. Initially, the
string “1” is assigned to the variable. Each time a <a class="reference external" href="next.html">next</a>
command is used with the variable name, the next string (“2”, “3”, etc)
is assigned. All processors assign the same string to the variable. The
<em>loop</em> style can also be specified with two arguments N1 and N2. In this
case the loop runs from N1 to N2 inclusive, and the string N1 is
initially assigned to the variable. N1 &lt;= N2 and N2 &gt;= 0 is required.</p>
<p>For the <em>world</em> style, one or more strings are specified. There must be
one string for each processor partition or “world”. See <a class="reference external" href="Section_start.html#start_6">Section
2.6</a> of the manual for information on
running SPARTA with multiple partitions via the “-partition”
command-line switch. This variable command assigns one string to each
world. All processors in the world are assigned the same string. The
next command cannot be used with <em>equal</em> style variables, since there is
only one value per world. This style of variable is useful when you wish
to run different simulations on different partitions.</p>
<p>For the <em>universe</em> style, one or more strings are specified. There must
be at least as many strings as there are processor partitions or
“worlds”. See <a class="reference external" href="Section_start.html#start_6">this page</a> for information
on running SPARTA with multiple partitions via the “-partition”
command-line switch. This variable command initially assigns one string
to each world. When a <a class="reference external" href="next.html">next</a> command is encountered using
this variable, the first processor partition to encounter it, is
assigned the next available string. This continues until all the
variable strings are consumed. Thus, this command can be used to run 50
simulations on 8 processor partitions. The simulations will be run one
after the other on whatever partition becomes available, until they are
all finished. <em>Universe</em> style variables are incremented using the files
“tmp.sparta.variable” and “tmp.sparta.variable.lock” which you will see
in your directory during such a SPARTA run.</p>
<p>The <em>uloop</em> style is identical to the <em>universe</em> style except that the
strings are the integers from 1 to N. This allows generation of long
list of runs (e.g. 1000) without having to list N strings in the input
script.</p>
<p>For the <em>string</em> style, a single string is assigned to the variable. The
only difference between this and using the <em>index</em> style with a single
string is that a variable with <em>string</em> style can be redefined. E.g. by
another command later in the input script, or if the script is read
again in a loop.</p>
<p>For the <em>format</em> style, an equal-style variable is specified along with
a C-style format string, e.g. “%f” or “%.10g”, which must be appropriate
for formatting a double-precision floating-point value. This allows an
equal-style variable to be formatted specifically for output as a
string, e.g. by the <a class="reference external" href="print.html">print</a> command, if the default
format “%.15g” has too much precision.</p>
<p>For the <em>getenv</em> style, a single string is assigned to the variable
which should be the name of an environment variable. When the variable
is evaluated, it returns the value of the environment variable, or an
empty string if it not defined. This style of variable can be used to
adapt the behavior of SPARTA input scripts via environment variable
settings, or to retrieve information that has been previously stored
with the <a class="reference external" href="shell.html">shell putenv</a> command. Note that because
environment variable settings are stored by the operating systems, they
persist beyond a <a class="reference external" href="clear.html">clear</a> command.</p>
<p>For the <em>file</em> style, a filename is provided which contains a list of
strings to assign to the variable, one per line. The strings can be
numeric values if desired. See the discussion of the next() function
below for equal-style variables, which will convert the string of a
file-style variable into a numeric value in a formula.</p>
<p>When a file-style variable is defined, the file is opened and the string
on the first line is read and stored with the variable. This means the
variable can then be evaluated as many times as desired and will return
that string. There are two ways to cause the next string from the file
to be read: use the <a class="reference external" href="next.html">next</a> command or the next() function
in an equal- or atom-style variable, as discussed below.</p>
<p>The rules for formatting the file are as follows. A comment character
“#” can be used anywhere on a line; text starting with the comment
character is stripped. Blank lines are skipped. The first “word” of a
non-blank line, delimited by white space, is the “string” assigned to
the variable.</p>
<p>For the <em>internal</em> style a numeric value is provided. This value will be
assigned to the variable until a SPARTA command sets it to a new value.
There is currently only one command that requirew <em>internal</em> variables
as inputs, because it resets them:
<a class="reference external" href="create_particles.html">create_particles</a>. As mentioned above, an
internal-style variable can be used in place of an equal-style variable
anywhere else in an input script, e.g. as an argument to another command
that allows for equal-style variables.</p>
<hr class="docutils" />
<p>For the <em>equal</em> and <em>particle</em> and <em>grid</em> styles, a single string is
specified which represents a formula that will be evaluated afresh each
time the variable is used. If you want spaces in the string, enclose it
in double quotes so the parser will treat it as a single argument. For
<em>equal</em> style variables the formula computes a scalar quantity, which
becomes the value of the variable whenever it is evaluated. For
<em>particle</em> style variables the formula computes one quantity for each
particle whenever it is evaluated. For <em>grid</em> style variables the
formula computes one quantity for each grid cell whenever it is
evaluated. A <em>grid</em> style variable computes quantites for all flavors of
child grid cells in the simulation, which includes unsplit, cut, split,
and sub cells. See <a class="reference external" href="Section_howto.html#howto_8">Section 4.8</a> of the
manual gives details of how SPARTA defines child, unsplit, split, and
sub cells.</p>
<p>Note that <em>equal</em> and <em>particle</em> and <em>grid</em> variables can produce
different values at different stages of the input script or at different
times during a run. For example, if an <em>equal</em> variable is used in a
<a class="reference external" href="fix_print.html">fix print</a> command, different values could be
printed each timestep it was invoked. If you want a variable to be
evaluated immediately, so that the result is stored by the variable
instead of the string, see the section below on “Immediate Evaluation of
Variables”.</p>
<p>The next command cannot be used with <em>equal</em> or <em>particle</em> or <em>grid</em>
style variables, since there is only one string.</p>
<p>The formula for an <em>equal</em> or <em>particle</em> or <em>grid</em> variable can contain
a variety of quantities. The syntax for each kind of quantity is simple,
but multiple quantities can be nested and combined in various ways to
build up formulas of arbitrary complexity. For example, this is a valid
(though strange) variable formula:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">x</span> <span class="n">equal</span> <span class="s2">&quot;np + c_MyTemp / vol^(1/3)&quot;</span>
</pre></div>
</div>
<p>Specifically, a formula can contain numbers, stats keywords, math
operators, math functions, particle vectors, compute references, fix
references, and references to other variables.</p>
<div class="docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Number</p></td>
<td><p>0.2, 100, 1.0e20, -15.4, etc</p></td>
</tr>
<tr class="row-even"><td><p>Constant</p></td>
<td><p>PI</p></td>
</tr>
<tr class="row-odd"><td><p>Stats keywords</p></td>
<td><p>step, np, vol, etc</p></td>
</tr>
<tr class="row-even"><td><p>Math operators</p></td>
<td><p>(), -x, x+y, x-y, x*y, x/y, x^y, x%y, x==y, x!=y, xy, x&gt;=y, x&amp;&amp;y, x||y, !x</p></td>
</tr>
<tr class="row-odd"><td><p>Math functions</p></td>
<td><p>sqrt(x), exp(x), ln(x), log(x), abs(x), sin(x), cos(x), tan(x), asin(x), acos(x), atan(x), atan2(y,x), random(x,y,z), normal(x,y,z), ceil(x), floor(x), round(x), ramp(x,y), stagger(x,y), logfreq(x,y,z), stride(x,y,z), vdisplace(x,y), swiggle(x,y,z), cwiggle(x,y,z)</p></td>
</tr>
<tr class="row-even"><td><p>Special functions</p></td>
<td><p>sum(x), min(x), max(x), ave(x), trap(x), slope(x), next(x)</p></td>
</tr>
<tr class="row-odd"><td><p>Particle vectors</p></td>
<td><p>mass, type, x, y, z, vx, vy, vz</p></td>
</tr>
<tr class="row-even"><td><p>Compute references</p></td>
<td><p>c_ID, c_ID[i], c_ID[i][j]</p></td>
</tr>
<tr class="row-odd"><td><p>Fix references</p></td>
<td><p>f_ID, f_ID[i], f_ID[i][j]</p></td>
</tr>
<tr class="row-even"><td><p>Surface collision model references</p></td>
<td><p>s_ID[i]</p></td>
</tr>
<tr class="row-odd"><td><p>Surface reaction model references</p></td>
<td><p>r_ID[i]</p></td>
</tr>
<tr class="row-even"><td><p>Other variables</p></td>
<td><p>v_name</p></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<p>Most of the formula elements produce a scalar value. A few produce a
per-particle vector or per-grid vector of values. These are the particle
vectors, compute references that represent a per-particle or per-grid
vector, fix references that represent a per-particle or per-grid vector,
and variables that are particle-style or grid-style variables. Math
functions that operate on scalar values produce a scalar value; math
function that operate on per-particle vectors do so element-by-element
and produce a per-particle vector.</p>
<p>A formula for equal-style variables cannot use any formula element that
produces a per-particle or per-grid vector. A formula for a
particle-style variable can use formula elements that produce either a
scalar value or a per-particle vector, but not a per-grid vector.
Likewise a particlgrid-style variable can use formula elements that
produce either a scalar value or a per-grid vector, but not a
per-particle vector.</p>
<p>The stats keywords allowed in a formula are those defined by the
<a class="reference external" href="stats_style.html">stats_style custom</a> command. If a variable is
evaluated directly in an input script (not during a run), then the
values accessed by the stats keyword must be current. See the discussion
below about “Variable Accuracy”.</p>
<hr class="docutils" />
<div class="section" id="math-operators">
<h2>Math Operators<a class="headerlink" href="#math-operators" title="Permalink to this headline">¶</a></h2>
<p>Math operators are written in the usual way, where the “x” and “y” in
the examples can themselves be arbitrarily complex formulas, as in the
examples above. In this syntax, “x” and “y” can be scalar values or
per-particle or per-grid vectors. For example, “vol/np” is the division
of two scalars, where “vy+vz” is the element-by-element sum of two
per-particle vectors of y and z velocities.</p>
<p>Operators are evaluated left to right and have the usual C-style
precedence: unary minus and unary logical NOT operator “!” have the
highest precedence, exponentiation “^” is next; multiplication and
division and the modulo operator “%” are next; addition and subtraction
are next; the 4 relational operators “&lt;”, “&lt;=”, “&gt;”, and “&gt;=” are next;
the two remaining relational operators “==” and “!=” are next; then the
logical AND operator “&amp;&amp;”; and finally the logical OR operator “||” has
the lowest precedence. Parenthesis can be used to group one or more
portions of a formula and/or enforce a different order of evaluation
than what would occur with the default precedence.</p>
<p>IMPORTANT NOTE: Because a unary minus is higher precedence than
exponentiation, the formula “-2^2” will evaluate to 4, not -4. This
convention is compatible with some programming languages, but not
others. As mentioned, this behavior can be easily overridden with
parenthesis; the formula “-(2^2)” will evaluate to -4.</p>
<p>The 6 relational operators return either a 1.0 or 0.0 depending on
whether the relationship between x and y is TRUE or FALSE. For example
the expression x&lt;10.0 in a particle-style variable formula will return
1.0 for all particles whose x-coordinate is less than 10.0, and 0.0 for
the others. The logical AND operator will return 1.0 if both its
arguments are non-zero, else it returns 0.0. The logical OR operator
will return 1.0 if either of its arguments is non-zero, else it returns
0.0. The logical NOT operator returns 1.0 if its argument is 0.0, else
it returns 0.0.</p>
<p>These relational and logical operators can be used as a masking or
selection operation in a formula. For example, the number of particles
whose properties satifsy one or more criteria could be calculated by
taking the returned per-particle vector of ones and zeroes and passing
it to the <a class="reference external" href="compute_reduce.html">compute reduce</a> command.</p>
</div>
<hr class="docutils" />
<div class="section" id="math-functions">
<h2>Math Functions<a class="headerlink" href="#math-functions" title="Permalink to this headline">¶</a></h2>
<p>Math functions are specified as keywords followed by one or more
parenthesized arguments “x”, “y”, “z”, each of which can themselves be
arbitrarily complex formulas. In this syntax, the arguments can
represent scalar values or per-particle or per-grid vectors. In the
latter cases, the math operation is performed on each element of the
vector. For example, “sqrt(np)” is the sqrt() of a scalar, where
“sqrt(y*z)” yields a per-particle vector with each element being the
sqrt() of the product of one particle’s y and z coordinates.</p>
<p>Most of the math functions perform obvious operations. The ln() is the
natural log; log() is the base 10 log.</p>
<p>The random(x,y) function takes 2 arguments: x = lo and y = hi. It
generates a uniform random number between lo and hi. The normal(x,y)
function also takes 2 arguments: x = mu and y = sigma. It generates a
Gaussian variate centered on mu with variance sigma^2. For equal-style
variables, every processor uses the same random number seed so that they
each generate the same sequence of random numbers. For particle-style or
grid-style variables, a unique seed is created for each processor. This
effectively generates a different random number for each particle or
grid cell being looped over in the particle-style or grid-style
variable.</p>
<p>IMPORTANT NOTE: Internally, there is just one random number generator
for all equal-style variables and one for all particle-style and
grid-style variables. If you define multiple variables (of each style)
which use the random() or normal() math functions, then the internal
random number generators will only be initialized once.</p>
<p>The ceil(), floor(), and round() functions are those in the C math
library. Ceil() is the smallest integer not less than its argument.
Floor() if the largest integer not greater than its argument. Round() is
the nearest integer to its argument.</p>
<p>The ramp(x,y) function uses the current timestep to generate a value
linearly intepolated between the specified x,y values over the course of
a run, according to this formula:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">timestep</span><span class="o">-</span><span class="n">startstep</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">stopstep</span><span class="o">-</span><span class="n">startstep</span><span class="p">)</span>
</pre></div>
</div>
<p>The run begins on startstep and ends on stopstep. Startstep and stopstep
can span multiple runs, using the <em>start</em> and <em>stop</em> keywords of the
<a class="reference external" href="run.html">run</a> command. See the <a class="reference external" href="run.html">run</a> command for
details of how to do this.</p>
<p>IMPORTANT NOTE: Currently, the run command does not currently support
the start/stop keywords. In the formula above startstep = 0 and stopstep
= the number of timesteps being performed by the run.</p>
<p>The stagger(x,y) function uses the current timestep to generate a new
timestep. X,y &gt; 0 and x &gt; y are required. The generated timesteps
increase in a staggered fashion, as the sequence
x,x+y,2x,2x+y,3x,3x+y,etc. For any current timestep, the next timestep
in the sequence is returned. Thus if stagger(1000,100) is used in a
variable by the <a class="reference external" href="dump_modify.html">dump_modify every</a> command, it
will generate the sequence of output timesteps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1100</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2100</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="n">etc</span>
</pre></div>
</div>
<p>The logfreq(x,y,z) function uses the current timestep to generate a new
timestep. X,y,z &gt; 0 and y &lt; z are required. The generated timesteps
increase in a logarithmic fashion, as the sequence
x,2x,3x,…y*x,z*x,2*z*x,3*z*x,…y*z*x,z*z*x,2*z*x*x,etc. For any
current timestep, the next timestep in the sequence is returned. Thus if
logfreq(100,4,10) is used in a variable by the <a class="reference external" href="dump_modify.html">dump_modify
every</a> command, it will generate the sequence of
output timesteps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">4000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">20000</span><span class="p">,</span><span class="n">etc</span>
</pre></div>
</div>
<p>The stride(x,y,z) function uses the current timestep to generate a new
timestep. X,y &gt;= 0 and z &gt; 0 and x &lt;= y are required. The generated
timesteps increase in increments of z, from x to y, I.e. it generates
the sequece x,x+z,x+2z,…,y. If y-x is not a multiple of z, then
similar to the way a for loop operates, the last value will be one that
does not exceed y. For any current timestep, the next timestep in the
sequence is returned. Thus if stagger(1000,2000,100) is used in a
variable by the <a class="reference external" href="dump_modify.html">dump_modify every</a> command, it
will generate the sequence of output timesteps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1000</span><span class="p">,</span><span class="mi">1100</span><span class="p">,</span><span class="mi">1200</span><span class="p">,</span> <span class="o">...</span> <span class="p">,</span><span class="mi">1900</span><span class="p">,</span><span class="mi">2000</span>
</pre></div>
</div>
<p>The vdisplace(x,y) function takes 2 arguments: x = value0 and y =
velocity, and uses the elapsed time to change the value by a linear
displacement due to the applied velocity over the course of a run,
according to this formula:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">value0</span> <span class="o">+</span> <span class="n">velocity</span><span class="o">*</span><span class="p">(</span><span class="n">timestep</span><span class="o">-</span><span class="n">startstep</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span>
</pre></div>
</div>
<p>where dt = the timestep size.</p>
<p>The run begins on startstep. Startstep can span multiple runs, using the
<em>start</em> keyword of the <a class="reference external" href="run.html">run</a> command. See the
<a class="reference external" href="run.html">run</a> command for details of how to do this. Note that the
<a class="reference external" href="stats_style.html">stats_style</a> keyword <em>elaplong</em> =
timestep-startstep.</p>
<p>The swiggle(x,y,z) and cwiggle(x,y,z) functions each take 3 arguments: x
= value0, y = amplitude, z = period. They use the elapsed time to
oscillate the value by a sin() or cos() function over the course of a
run, according to one of these formulas, where omega = 2 PI / period:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="o">=</span> <span class="n">value0</span> <span class="o">+</span> <span class="n">Amplitude</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="p">(</span><span class="n">timestep</span><span class="o">-</span><span class="n">startstep</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
<span class="n">value</span> <span class="o">=</span> <span class="n">value0</span> <span class="o">+</span> <span class="n">Amplitude</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">omega</span><span class="o">*</span><span class="p">(</span><span class="n">timestep</span><span class="o">-</span><span class="n">startstep</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
</pre></div>
</div>
<p>where dt = the timestep size.</p>
<p>The run begins on startstep. Startstep can span multiple runs, using the
<em>start</em> keyword of the <a class="reference external" href="run.html">run</a> command. See the
<a class="reference external" href="run.html">run</a> command for details of how to do this. Note that the
<a class="reference external" href="stats_style.html">stats_style</a> keyword <em>elaplong</em> =
timestep-startstep.</p>
</div>
<hr class="docutils" />
<div class="section" id="special-functions">
<h2>Special Functions<a class="headerlink" href="#special-functions" title="Permalink to this headline">¶</a></h2>
<p>Special functions take specific kinds of arguments, meaning their
arguments cannot be formulas themselves.</p>
<p>The sum(x), min(x), max(x), ave(x), trap(x), and slope(x) functions each
take 1 argument which is of the form “c_ID” or “c_ID[N]” or “f_ID” or
“f_ID[N]”. The first two are computes and the second two are fixes; the
ID in the reference should be replaced by the ID of a compute or fix
defined elsewhere in the input script. The compute or fix must produce
either a global vector or array. If it produces a global vector, then
the notation without “[N]” should be used. If it produces a global
array, then the notation with “[N]” should be used, when N is an
integer, to specify which column of the global array is being
referenced.</p>
<p>These functions operate on the global vector of inputs and reduce it to
a single scalar value. This is analagous to the operation of the
<a class="reference external" href="compute_reduce.html">compute reduce</a> command, which invokes the same
functions on per-particle or per-grid vectors.</p>
<p>The sum() function calculates the sum of all the vector elements. The
min() and max() functions find the minimum and maximum element
respectively. The ave() function is the same as sum() except that it
divides the result by the length of the vector.</p>
<p>The trap() function is the same as sum() except the first and last
elements are multiplied by a weighting factor of 1/2 when performing the
sum. This effectively implements an integratiion via the trapezoidal
rule on the global vector of data. I.e. consider a set of points,
equally spaced by 1 in their x coordinate: (1,V1), (2,V2), …, (N,VN),
where the Vi are the values in the global vector of length N. The
integral from 1 to N of these points is trap().</p>
<p>The slope() function uses linear regression to fit a line to the set of
points, equally spaced by 1 in their x coordinate: (1,V1), (2,V2), …,
(N,VN), where the Vi are the values in the global vector of length N.
The returned value is the slope of the line. If the line has a single
point or is vertical, it returns 1.0e20.</p>
<p>The next(x) function takes 1 argument which is a variable ID (not
“v_foo”, just “foo”). It must be for a file-style or atomfile-style
variable. Each time the next() function is invoked (i.e. each time the
equal-style or atom-style variable is evaluated), the following steps
occur.</p>
<p>For file-style variables, the current string value stored by the
file-style variable is converted to a numeric value and returned by the
function. And the next string value in the file is read and stored. Note
that if the line previously read from the file was not a numeric string,
then it will typically evaluate to 0.0, which is likely not what you
want.</p>
<p>Since file-style variables read and store the first line of the file
when they are defined in the input script, this is the value that will
be returned the first time the next() function is invoked. If next() is
invoked more times than there are lines in the file, the variable is
deleted, similar to how the <a class="reference external" href="next.html">next</a> command operates.</p>
</div>
<hr class="docutils" />
<div class="section" id="particle-vectors">
<h2>Particle Vectors<a class="headerlink" href="#particle-vectors" title="Permalink to this headline">¶</a></h2>
<p>Particle vectors generate one value per particle, so that a reference
like “vx” means the x-component of each particles’s velocity will be
used when evaluating the variable.</p>
<p>The meaning of the different particle vectors is self-explanatory.</p>
<p>Particle vectors can only be used in <em>particle</em> style variables, not in
<em>equal</em> or <em>grid</em> style varaibles.</p>
</div>
<hr class="docutils" />
<div class="section" id="compute-references">
<h2>Compute References<a class="headerlink" href="#compute-references" title="Permalink to this headline">¶</a></h2>
<p>Compute references access quantities calculated by a
<a class="reference external" href="compute.html">compute</a>. The ID in the reference should be replaced
by the ID of a compute defined elsewhere in the input script. As
discussed in the doc page for the <a class="reference external" href="compute.html">compute</a> command,
computes can produce global, per-particle, per-grid, or per-surf values.
Only global and per-particle and per-grid values can be used in a
variable. Computes can also produce a scalar, vector, or array. An
equal-style variable can only use scalar values, which means a global
scalar, or an element of a global vector or array. Particle-style
variables can use the same scalar values. They can also use per-particle
vector values. A vector value can be a per-particle vector itself, or a
column of an per-particle array. Grid-style variables can use the same
scalar values. They can also use per-grid vector values. A vector value
can be a per-grid vector itself, or a column of an per-grid array. See
the doc pages for individual computes to see what kind of values they
produce.</p>
<p>Examples of different kinds of compute references are as follows. There
is no ambiguity as to what a reference means, since computes only
produce global or per-particle or per-grid quantities, never more than
one kind of quantity.</p>
<div class="docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>c_ID</p></td>
<td><p>global scalar, or per-particle or per-grid vector</p></td>
</tr>
<tr class="row-even"><td><p>c_ID[I]</p></td>
<td><p>Ith element of global vector, or Ith column from per-particle or per-grid array</p></td>
</tr>
<tr class="row-odd"><td><p>c_ID[I][J]</p></td>
<td><p>I,J element of global array</p></td>
</tr>
</tbody>
</table>
</div>
<p>For I and J, integers can be specified or a variable name, specified as
v_name, where name is the name of the variable, like x[v_myIndex]. The
variable can be of any style expect particle-style. The variable is
evaluated and the result is expected to be numeric and is cast to an
integer (i.e. 3.4 becomes 3), to use an an index, which must be a value
from 1 to N. Note that a “formula” cannot be used as the argument
between the brackets, e.g. x[243+10] or x[v_myIndex+1] are not allowed.
To do this a single variable can be defined that contains the needed
formula.</p>
<p>If a variable containing a compute is evaluated directly in an input
script (not during a run), then the values accessed by the compute must
be current. See the discussion below about “Variable Accuracy”.</p>
</div>
<hr class="docutils" />
<div class="section" id="fix-references">
<h2>Fix References<a class="headerlink" href="#fix-references" title="Permalink to this headline">¶</a></h2>
<p>Fix references access quantities calculated by a <a class="reference external" href="compute.html">fix</a>.
The ID in the reference should be replaced by the ID of a fix defined
elsewhere in the input script. As discussed in the doc page for the
<a class="reference external" href="fix.html">fix</a> command, fixes can produce global, per-particle,
per-grid, or per-surf values. Only global and per-particle and per-grid
values can be used in a variable. Fixes can also produce a scalar,
vector, or array. An equal-style variable can only use scalar values,
which means a global scalar, or an element of a global vector or array.
Particle-style variables can use the same scalar values. They can also
use per-particle vector values. A vector value can be a per-particle
vector itself, or a column of an per-particle array. Grid-style
variables can use the same scalar values. They can also use per-grid
vector values. A vector value can be a per-grid vector itself, or a
column of an per-grid array. See the doc pages for individual fixes to
see what kind of values they produce.</p>
<p>The different kinds of fix references are exactly the same as the
compute references listed in the above table, where <code class="docutils literal notranslate"><span class="pre">c_</span></code> is replaced by
<code class="docutils literal notranslate"><span class="pre">f_</span></code>. Again, there is no ambiguity as to what a reference means, since
fixes only produce global or per-particle or per-grid quantities, never
more than one kind of quantity.</p>
<div class="docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>f_ID</p></td>
<td><p>global scalar, or per-particle or per-grid vector</p></td>
</tr>
<tr class="row-even"><td><p>f_ID[I]</p></td>
<td><p>Ith element of global vector, or Ith column from per-particle or per-grid array</p></td>
</tr>
<tr class="row-odd"><td><p>f_ID[I][J]</p></td>
<td><p>I,J element of global array</p></td>
</tr>
</tbody>
</table>
</div>
<p>For I and J, integers can be specified or a variable name, specified as
v_name, where name is the name of the variable. The rules for this
syntax are the same as for the “Compute References” discussion above.</p>
<p>If a variable containing a fix is evaluated directly in an input script
(not during a run), then the values accessed by the fix should be
current. See the discussion below about “Variable Accuracy”.</p>
<p>Note that some fixes only generate quantities on certain timesteps. If a
variable attempts to access the fix on non-allowed timesteps, an error
is generated. For example, the <a class="reference external" href="fix_ave_time.html">fix ave/time</a>
command may only generate averaged quantities every 100 steps. See the
doc pages for individual fix commands for details.</p>
</div>
<hr class="docutils" />
<div class="section" id="surface-collision-and-surface-reaction-model-references">
<h2>Surface Collision and Surface Reaction Model References<a class="headerlink" href="#surface-collision-and-surface-reaction-model-references" title="Permalink to this headline">¶</a></h2>
<p>These references access quantities calculated by a
<a class="reference external" href="surf_collide.html">surf_collide</a> or <a class="reference external" href="surf_react.html">surf_react</a>
command. The ID in the reference should be replaced by the ID of a
surface collision or surface reaction model defined elsewhere in the
input script. As discussed in the doc pages for the
<a class="reference external" href="surf_collide.html">surf_collide</a> and
<a class="reference external" href="surf_react.html">surf_react</a> commands, these commmands produce
global vectors, the elements of which can be accessed by equal-style or
particle-style or grid-style variables, e.g.</p>
<div class="docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 89%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>s_ID[I]</p></td>
<td><p>Ith element of global vector for a surface collision model</p></td>
</tr>
<tr class="row-even"><td><p>r_ID[I]</p></td>
<td><p>Ith element of global vector for a surface reaction model</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<hr class="docutils" />
<div class="section" id="variable-references">
<h2>Variable References<a class="headerlink" href="#variable-references" title="Permalink to this headline">¶</a></h2>
<p>Variable references access quantities stored or calculated by other
variables, which will cause those variables to be evaluated. The name in
the reference should be replaced by the name of a variable defined
elsewhere in the input script.</p>
<p>As discussed on this doc page, equal-style variables generate a global
scalar numeric value; particle-style variables generate a per-particle
vector of numeric values; grid-style variables generate a per-grid
vector of numeric values; all other variables store a string. The
formula for an equal-style variable can use any style of variable except
a particle- or grid-style. The formula for a particle-style variable can
use any style of variable except a grid-style. The formula for a
grid-style variable can use any style of variable except a
particle-style. If a string-storing variable is used, the string is
converted to a numeric value. Note that this will typically produce a
0.0 if the string is not a numeric string, which is likely not what you
want. The formula for a particle-style variable can use any style of
variable, including other particle-style variables.</p>
<p>Examples of different kinds of variable references are as follows. There
is no ambiguity as to what a reference means, since variables produce
only a global scalar or a per-particle or per-grid vector, never more
than one of these quantities.</p>
<div class="docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 88%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>v_name</p></td>
<td><p>scalar, or per-particle or per-grid vector</p></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<p><strong>Immediate Evaluation of Variables:</strong></p>
<p>There is a difference between referencing a variable with a leading $
sign (e.g. $x or ${abc}) versus with a leading <code class="docutils literal notranslate"><span class="pre">v_</span></code> (e.g. v_x or v_abc).
The former can be used in any input script command, including a variable
command. The input script parser evaluates the reference variable
immediately and substitutes its value into the command. As explained in
<a class="reference external" href="Section_commands.html#3_2">Section commands 3.2</a> for “Parsing
rules”, you can also use un-named “immediate” variables for this
purpose. For example, a string like this $((xlo+xhi)/2+sqrt(v_area)) in
an input script command evaluates the string between the parenthesis as
an equal-style variable formula.</p>
<p>Referencing a variable with a leading <code class="docutils literal notranslate"><span class="pre">v_</span></code> is an optional or required
kind of argument for some commands (e.g. the <a class="reference external" href="fix_ave_spatial.html">fix
ave/spatial</a> or <a class="reference external" href="dump.html">dump custom</a> or
<a class="reference external" href="stats_style.html">stats_style</a> commands) if you wish it to evaluate
a variable periodically during a run. It can also be used in a variable
formula if you wish to reference a second variable. The second variable
will be evaluated whenever the first variable is evaluated.</p>
<p>As an example, suppose you use this command in your input script to
define the variable “n” as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">n</span> <span class="n">equal</span> <span class="n">np</span>
</pre></div>
</div>
<p>before a run where the particle count changes. You might think this will
assign the initial count to the variable “n”. That is not the case.
Rather it assigns a formula which evaluates the count (using the
stats_style keyword “np”) to the variable “n”. If you use the variable
“n” in some other command like <a class="reference external" href="fix_ave_time.html">fix ave/time</a> then
the current particle count will be evaluated continuously during the
run.</p>
<p>If you want to store the initial particle count of the system, it can be
done in this manner:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>variable n equal np
variable n0 equal $n
</pre></div>
</div>
<p>The second command will force “n” to be evaluated (yielding the initial
count) and assign that value to the variable “n0”. Thus the command</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stats_style</span> <span class="n">custom</span> <span class="n">step</span> <span class="n">v_n</span> <span class="n">v_n0</span>
</pre></div>
</div>
<p>would print out both the current and initial particle count periodically
during the run.</p>
<p>Also note that it is a mistake to enclose a variable formula in quotes
if it contains variables preceeded by $ signs. For example,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">variable</span> <span class="n">nratio</span> <span class="n">equal</span> <span class="s2">&quot;$</span><span class="si">{nfinal}</span><span class="s2">/$</span><span class="si">{n0}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>This is because the quotes prevent variable substitution (see <a class="reference external" href="Section_commands.html#cmd_2">Section
2.2</a> of the manual on parsing input
script commands), and thus an error will occur when the formula for
“nratio” is evaluated later.</p>
<hr class="docutils" />
<p><strong>Variable Accuracy:</strong></p>
<p>Obviously, SPARTA attempts to evaluate variables containing formulas
(<em>equal</em> and <em>particle</em> and <em>grid</em> style variables) accurately whenever
the evaluation is performed. Depending on what is included in the
formula, this may require invoking a <a class="reference external" href="compute.html">compute</a>, or
accessing a value previously calculated by a compute, or accessing a
value calculated and stored by a <a class="reference external" href="fix.html">fix</a>. If the compute is
one that calculates certain properties of the system such as the
pressure induced on a global boundary due to collisions, then these
quantities need to be tallied during the timesteps on which the variable
will need the values.</p>
<p>SPARTA keeps track of all of this during a <a class="reference external" href="run.html">run</a>. An error
will be generated if you attempt to evaluate a variable on timesteps
when it cannot produce accurate values. For example, if a <a class="reference external" href="stats_style.html">stats_style
custom</a> command prints a variable which accesses
values stored by a <a class="reference external" href="fix_ave_time.html">fix ave/time</a> command and the
timesteps on which stats output is generated are not multiples of the
averaging frequency used in the fix command, then an error will occur.</p>
<p>An input script can also request variables be evaluated before or after
or in between runs, e.g. by including them in a <a class="reference external" href="print.html">print</a>
command. In this case, if a compute is needed to evaluate a variable
(either directly or indirectly), SPARTA will not invoke the compute, but
it will use a value previously calculated by the compute, and can do
this only if it was invoked on the current timestep. Fixes will always
provide a quantity needed by a variable, but the quantity may or may not
be current. This leads to one of three kinds of behavior:</p>
<p>(1) The variable may be evaluated accurately. If it contains references
to a compute or fix, and these values were calculated on the last
timestep of a preceeding run, then they will be accessed and used by the
variable and the result will be accurate.</p>
<p>(2) SPARTA may not be able to evaluate the variable and will generate an
error message stating so. For example, if the variable requires a
quantity from a <a class="reference external" href="compute.html">compute</a> that has not been invoked on
the current timestep, SPARTA will generate an error. This means, for
example, that such a variable cannot be evaluated before the first run
has occurred. Likewise, in between runs, a variable containing a compute
cannot be evaluated unless the compute was invoked on the last timestep
of the preceding run, e.g. by stats output.</p>
<p>One way to get around this problem is to perform a 0-timestep run before
using the variable. For example, these commands</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myTemp</span> <span class="n">grid</span> <span class="nb">all</span> <span class="n">temp</span>
<span class="n">variable</span> <span class="n">t</span> <span class="n">equal</span> <span class="n">c_myTemp1</span>
<span class="nb">print</span> <span class="s2">&quot;Initial temperature = $t&quot;</span>
<span class="n">run</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>will generate an error if the run is the first run specified in the
input script, because generating a value for the “t” variable requires a
compute for calculating the temperature to be invoked.</p>
<p>However, this sequence of commands would be fine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myTemp</span> <span class="n">grid</span> <span class="nb">all</span> <span class="n">temp</span>
<span class="n">variable</span> <span class="n">t</span> <span class="n">equal</span> <span class="n">c_myTemp1</span>
<span class="n">run</span> <span class="mi">0</span>
<span class="nb">print</span> <span class="s2">&quot;Initial temperature = $t&quot;</span>
<span class="n">run</span> <span class="mi">1000</span>
</pre></div>
</div>
<p>The 0-timestep run initializes and invokes various computes, including
the one for temperature, so that the value it stores is current and can
be accessed by the variable “t” after the run has completed. Note that a
0-timestep run does not alter the state of the system, so it does not
change the input state for the 1000-timestep run that follows. Also note
that the 0-timestep run must actually use and invoke the compute in
question (e.g. via <a class="reference external" href="stats_style.html">stats</a> or <a class="reference external" href="dump.html">dump</a>
output) in order for it to enable the compute to be used in a variable
after the run. Thus if you are trying to print a variable that uses a
compute you have defined, you can insure it is invoked on the last
timestep of the preceding run by including it in stats output.</p>
<p>Unlike computes, <a class="reference external" href="fix.html">fixes</a> will never generate an error if
their values are accessed by a variable in between runs. They always
return some value to the variable. However, the value may not be what
you expect if the fix has not yet calculated the quantity of interest or
it is not current. For example, the <a class="reference external" href="fix_indent.html">fix indent</a>
command stores the force on the indenter. But this is not computed until
a run is performed. Thus if a variable attempts to print this value
before the first run, zeroes will be output. Again, performing a
0-timestep run before printing the variable has the desired effect.</p>
<p>(3) The variable may be evaluated incorrectly. And SPARTA may have no
way to detect this has occurred. Consider the following sequence of
commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myTemp</span> <span class="n">grid</span> <span class="nb">all</span> <span class="n">temp</span>
<span class="n">variable</span> <span class="n">t</span> <span class="n">equal</span> <span class="n">c_myTemp1</span>
<span class="n">run</span> <span class="mi">1000</span>
<span class="n">create_particles</span> <span class="nb">all</span> <span class="n">n</span> <span class="mi">10000</span>
<span class="nb">print</span> <span class="s2">&quot;Final temperature = $t&quot;</span>
</pre></div>
</div>
<p>The first run is performed using the current set of particles. The
temperature is evaluated on the final timestep and stored by the
<a class="reference external" href="compute_grid.html">compute grid</a> compute (when invoked by the
<a class="reference external" href="stats_style.html">stats_style</a> command). Then new particles are
added by the <a class="reference external" href="create_particles.html">create_particles</a> command,
altering the temperature of the system. When the temperature is printed
via the “t” variable, SPARTA will use the temperature value stored by
the <a class="reference external" href="compute_grid.html">compute grid</a> compute, thinking it is
current. There are many other commands which could alter the state of
the system between runs, causing a variable to evaluate incorrectly.</p>
<p>The solution to this issue is the same as for case (2) above, namely
perform a 0-timestep run before the variable is evaluated to insure the
system is up-to-date. For example, this sequence of commands would print
a temperature that reflected the new particles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myTemp</span> <span class="n">grid</span> <span class="nb">all</span> <span class="n">temp</span>
<span class="n">variable</span> <span class="n">t</span> <span class="n">equal</span> <span class="n">c_myTemp1</span>
<span class="n">run</span> <span class="mi">1000</span>
<span class="n">create_particles</span> <span class="nb">all</span> <span class="n">n</span> <span class="mi">10000</span>
<span class="n">run</span> <span class="mi">0</span>
<span class="nb">print</span> <span class="s2">&quot;Final temperature = $t&quot;</span>
</pre></div>
</div>
<hr class="docutils" />
<p><strong>Restrictions:</strong></p>
<p>All <em>universe</em>- and <em>uloop</em>-style variables defined in an input script
must have the same number of values.</p>
<p><strong>Related commands:</strong></p>
<p><a class="reference internal" href="next.html#command-next"><span class="std std-ref">next command</span></a>,
<a class="reference internal" href="jump.html#command-jump"><span class="std std-ref">jump command</span></a>,
<a class="reference internal" href="include.html#command-include"><span class="std std-ref">include command</span></a>,
<a class="reference internal" href="fix_print.html#command-fix-print"><span class="std std-ref">fix print command</span></a>,
<a class="reference internal" href="print.html#command-print"><span class="std std-ref">print command</span></a></p>
<p><strong>Default:</strong> none</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, JF

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>