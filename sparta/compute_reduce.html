

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>compute reduce command &mdash; SPARTA 7 May 2020 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/rtd_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SPARTA
          

          
          </a>

          
            
            
              <div class="version">
                7 May 2020
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">4. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">5. Accelerating SPARTA performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">6. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">7. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">8. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">9. Additional tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_modify.html">10. Modifying &amp; extending SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">11. Python interface to SPARTA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">12. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">13. Future and history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SPARTA</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>compute reduce command</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/compute_reduce.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compute-reduce-command">
<span id="command-compute-reduce"></span><h1>compute reduce command<a class="headerlink" href="#compute-reduce-command" title="Permalink to this headline">Â¶</a></h1>
<p><strong>Syntax:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">ID</span> <span class="n">reduce</span> <span class="n">mode</span> <span class="n">input1</span> <span class="n">input2</span> <span class="o">...</span> <span class="n">keyword</span> <span class="n">args</span> <span class="o">...</span>
</pre></div>
</div>
<ul>
<li><p>ID is documented in <a class="reference external" href="compute.html">compute</a> command</p></li>
<li><p>reduce = style name of this compute command</p></li>
<li><p>mode = <em>sum</em> or <em>min</em> or <em>max</em> or <em>ave</em> or <em>sumsq</em> or <em>avesq</em></p></li>
<li><p>one or more inputs can be listed</p></li>
<li><p>input = x, y, z, vx, vy, vz, ke, erot, evib, c_ID, c_ID[N], f_ID,
f_ID[N], v_name</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">,</span><span class="n">vz</span> <span class="o">=</span> <span class="n">particle</span> <span class="n">position</span> <span class="ow">or</span> <span class="n">velocity</span> <span class="n">component</span>
<span class="n">ke</span><span class="p">,</span><span class="n">erot</span><span class="p">,</span><span class="n">evib</span> <span class="o">=</span> <span class="n">particle</span> <span class="n">energy</span> <span class="n">component</span>
<span class="n">c_ID</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">particle</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">vector</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">compute</span> <span class="k">with</span> <span class="n">ID</span>
<span class="n">c_ID</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ith</span> <span class="n">column</span> <span class="n">of</span> <span class="n">per</span><span class="o">-</span><span class="n">particle</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">array</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">compute</span> <span class="k">with</span> <span class="n">ID</span><span class="p">,</span> <span class="n">I</span> <span class="n">can</span> <span class="n">include</span> <span class="n">wildcard</span> <span class="p">(</span><span class="n">see</span> <span class="n">below</span><span class="p">)</span>
<span class="n">f_ID</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">particle</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">surf</span> <span class="n">vector</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">fix</span> <span class="k">with</span> <span class="n">ID</span>
<span class="n">f_ID</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ith</span> <span class="n">column</span> <span class="n">of</span> <span class="n">per</span><span class="o">-</span><span class="n">particle</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">surf</span> <span class="n">array</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">fix</span> <span class="k">with</span> <span class="n">ID</span><span class="p">,</span> <span class="n">I</span> <span class="n">can</span> <span class="n">include</span> <span class="n">wildcard</span> <span class="p">(</span><span class="n">see</span> <span class="n">below</span><span class="p">)</span>
<span class="n">v_name</span> <span class="o">=</span> <span class="n">per</span><span class="o">-</span><span class="n">particle</span> <span class="ow">or</span> <span class="n">per</span><span class="o">-</span><span class="n">grid</span> <span class="n">vector</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">a</span> <span class="n">particle</span><span class="o">-</span><span class="n">style</span> <span class="ow">or</span> <span class="n">grid</span><span class="o">-</span><span class="n">style</span> <span class="n">variable</span> <span class="k">with</span> <span class="n">name</span>
</pre></div>
</div>
</li>
<li><p>zero or more keyword/args pairs may be appended</p></li>
<li><p>keyword = <em>replace</em></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">replace</span> <span class="n">args</span> <span class="o">=</span> <span class="n">vec1</span> <span class="n">vec2</span>
  <span class="n">vec1</span> <span class="o">=</span> <span class="n">reduced</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">this</span> <span class="nb">input</span> <span class="n">vector</span> <span class="n">will</span> <span class="n">be</span> <span class="n">replaced</span>
  <span class="n">vec2</span> <span class="o">=</span> <span class="n">replace</span> <span class="n">it</span> <span class="k">with</span> <span class="n">vec1</span><span class="p">[</span><span class="n">N</span><span class="p">]</span> <span class="n">where</span> <span class="n">N</span> <span class="ow">is</span> <span class="n">index</span> <span class="n">of</span> <span class="nb">max</span><span class="o">/</span><span class="nb">min</span> <span class="n">value</span> <span class="kn">from</span> <span class="nn">vec2</span>
</pre></div>
</div>
</li>
</ul>
<p><strong>Examples:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="mi">1</span> <span class="n">reduce</span> <span class="nb">sum</span> <span class="n">c_grid</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>
<span class="n">compute</span> <span class="mi">2</span> <span class="n">reduce</span> <span class="nb">min</span> <span class="n">f_ave</span> <span class="n">v_myKE</span>
<span class="n">compute</span> <span class="mi">3</span> <span class="n">reduce</span> <span class="nb">max</span> <span class="n">c_mine</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">c_mine</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">c_temp</span> <span class="n">replace</span> <span class="mi">1</span> <span class="mi">3</span> <span class="n">replace</span> <span class="mi">2</span> <span class="mi">3</span>
</pre></div>
</div>
<p>These commands will include the average grid cell temperature, across
all grid cells, in the stats output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="mi">1</span> <span class="n">temp</span>
<span class="n">compute</span> <span class="mi">2</span> <span class="n">grid</span> <span class="nb">all</span> <span class="nb">all</span> <span class="n">temp</span>
<span class="n">compute</span> <span class="mi">3</span> <span class="n">reduce</span> <span class="n">ave</span> <span class="n">c_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">stats_style</span> <span class="n">step</span> <span class="n">c_temp</span> <span class="n">c_3</span>
</pre></div>
</div>
<p><strong>Description:</strong></p>
<p>Define a calculation that âreducesâ one or more vector inputs into
scalar values, one per listed input. The inputs can be per-particle or
per-grid or per-surf quantities; they cannot be global quantities.
Particle attributes are per-particle quantities,
<a class="reference external" href="compute.html">computes</a> may generate per-particle or per-grid
quantities, <a class="reference external" href="fix.html">fixes</a> may generate any of the three kinds of
quantities, and <a class="reference external" href="variable.html">particle-style or grid-style
variables</a> generate per-particle or per-grid
quantities. See the <a class="reference external" href="variable">variable</a> command and its special
functions which can perform the same operations as the compute reduce
command on global vectors.</p>
<p>The reduction operation is specified by the <em>mode</em> setting. The <em>sum</em>
option adds the values in the vector into a global total. The <em>min</em> or
<em>max</em> options find the minimum or maximum value across all vector
values. The <em>ave</em> setting adds the vector values into a global total,
then divides by the number of values in the vector. The <em>sumsq</em> option
sums the square of the values in the vector into a global total. The
<em>avesq</em> setting does the same as <em>sumsq</em>, then divdes the sum of squares
by the number of values. The last two options can be useful for
calculating the variance of some quantity, e.g. variance = sumsq -
ave^2.</p>
<p>Each listed input is operated on independently.</p>
<p>Each listed input can be a particle attribute or can be the result of a
<a class="reference external" href="compute.html">compute</a> or <a class="reference external" href="fix.html">fix</a> or the evaluation of a
<a class="reference external" href="variable.html">variable</a>.</p>
<p>Note that for values from a compute or fix, the bracketed index I can be
specified using a wildcard asterisk with the index to effectively
specify multiple values. This takes the form â*â or â<em>nâ or ân</em>â or
âm*nâ. If N = the size of the vector (for <em>mode</em> = scalar) or the number
of columns in the array (for <em>mode</em> = vector), then an asterisk with no
numeric values means all indices from 1 to N. A leading asterisk means
all indices from 1 to n (inclusive). A trailing asterisk means all
indices from n to N (inclusive). A middle asterisk means all indices
from m to n (inclusive).</p>
<p>Using a wildcard is the same as if the individual columns of the array
had been listed one by one. E.g. these 2 compute reduce commands are
equivalent, since the <a class="reference external" href="compute_grid.html">compute grid</a> command
creates a per-grid array with 3 columns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="n">myGrid</span> <span class="n">grid</span> <span class="nb">all</span> <span class="nb">all</span> <span class="n">u</span> <span class="n">v</span> <span class="n">w</span>
<span class="n">compute</span> <span class="mi">2</span> <span class="nb">all</span> <span class="n">reduce</span> <span class="nb">min</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="o">*</span><span class="p">]</span>
<span class="n">compute</span> <span class="mi">2</span> <span class="nb">all</span> <span class="n">reduce</span> <span class="nb">min</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">c_myGrid</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
<hr class="docutils" />
<p>The particle attributes x,y,z,vx,vy,vz are position and velocity
components. The ke,erot,evib attributes are for kinetic, rotational, and
vibrational energy of particles.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">c_</span></code>, a compute ID must follow which has been
previously defined in the input script. Computes can generate
per-particle or per-grid quantities. See the individual
<a class="reference external" href="compute.html">compute</a> doc page for details. If no bracketed integer
is appended, the vector calculated by the compute is used. If a
bracketed integer is appended, the Ith column of the array calculated by
the compute is used. Users can also write code for their own compute
styles and <a class="reference external" href="Section_modify.html">add them to SPARTA</a>. See the
discussion above for how I can be specified with a wildcard asterisk to
effectively specify multiple values.</p>
<p>IMPORTANT NOTE: A compute which generates per-surf quantities cannot be
used as input. This is because its values have not yet been combined
across processors to sum the contributions from all processors whose
particles collide with the same surface element. The combining is
performed by the <a class="reference external" href="fix_ave_surf.html">fix ave/surf</a> command, at each
of its <em>Nfreq</em> timesteps. Thus to use this compute on per-surf values,
specify a fix ID for a <a class="reference external" href="fix_ave_surf.html">fix ave/surf</a> and insure
the fix outputs its values when they are needed.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">f_</span></code>, a fix ID must follow which has been
previously defined in the input script. Fixes can generate per-particle
or per-grid or per-surf quantities. See the individual
<a class="reference external" href="fix.html">fix</a> doc page for details. Note that some fixes only
produce their values on certain timesteps, which must be compatible with
when this compute references the values, else an error results. If no
bracketed integer is appended, the vector calculated by the fix is used.
If a bracketed integer is appended, the Ith column of the array
calculated by the fix is used. Users can also write code for their own
fix style and <a class="reference external" href="Section_modify.html">add them to SPARTA</a>. See the
discussion above for how I can be specified with a wildcard asterisk to
effectively specify multiple values.</p>
<p>If a value begins with <code class="docutils literal notranslate"><span class="pre">v_</span></code>, a variable name must follow which has been
previously defined in the input script. It must be a <a class="reference external" href="variable.html">particle-style or
grid-style variable</a>. Both styles define formulas
which can reference stats keywords or invoke other computes, fixes, or
variables when they are evaluated. Particle-style variables can also
reference various per-particle attributes (position, velocity, etc). So
these variables are a very general means of creating per-particle or
per-grid quantities to reduce.</p>
<hr class="docutils" />
<p>If the <em>replace</em> keyword is used, two indices <em>vec1</em> and <em>vec2</em> are
specified, where each index ranges from 1 to the # of input values. The
replace keyword can only be used if the <em>mode</em> is <em>min</em> or <em>max</em>. It
works as follows. A min/max is computed as usual on the <em>vec2</em> input
vector. The index N of that value within <em>vec2</em> is also stored. Then,
instead of performing a min/max on the <em>vec1</em> input vector, the stored
index is used to select the Nth element of the <em>vec1</em> vector.</p>
<p>Here is an example which prints out both the grid cell ID and number of
particles for the grid cell with the maximum number of particles:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compute</span> <span class="mi">1</span> <span class="nb">property</span><span class="o">/</span><span class="n">grid</span> <span class="nb">id</span>
<span class="n">compute</span> <span class="mi">2</span> <span class="n">grid</span> <span class="nb">all</span> <span class="n">n</span>
<span class="n">compute</span> <span class="mi">3</span> <span class="n">reduce</span> <span class="nb">max</span> <span class="n">c_1</span> <span class="n">c_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">replace</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">stats_style</span> <span class="n">step</span> <span class="n">c_temp</span> <span class="n">c_3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">c_3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>The first two input values in the compute reduce command are vectors
with the ID and particle count of each grid cell. Instead of taking the
max of the ID vector, which does not yield useful information in this
context, the <em>replace</em> keyword will extract the ID for the grid cell
which has the maximum number of particles. This ID and the cellâs
particle count will be printed with the statistical output.</p>
<hr class="docutils" />
<p>If a single input is specified this compute produces a global scalar
value. If multiple inputs are specified, this compute produces a global
vector of values, the length of which is equal to the number of inputs
specified.</p>
<hr class="docutils" />
<p><strong>Output info:</strong></p>
<p>This compute calculates a global scalar if a single input value is
specified or a global vector of length N where N is the number of
inputs, and which can be accessed by indices 1 to N. These values can be
used by any command that uses global scalar or vector values from a
compute as input. See <a class="reference external" href="Section_howto.html#howto_4">Section 6.4</a> for
an overview of SPARTA output options.</p>
<p>The scalar or vector values will be in whatever <a class="reference external" href="units.html">units</a>
the quantities being reduced are in.</p>
<p><strong>Restrictions:</strong> none</p>
<p><strong>Related commands:</strong></p>
<p><a class="reference internal" href="compute.html#command-compute"><span class="std std-ref">compute command</span></a>,
<a class="reference internal" href="fix.html#command-fix"><span class="std std-ref">fix command</span></a>,
<a class="reference internal" href="variable.html#command-variable"><span class="std std-ref">variable command</span></a></p>
<p><strong>Default:</strong> none</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, JF

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>